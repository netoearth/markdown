GIF

![](https://i0.hdslb.com/bfs/article/4a10568f28aa362fc3ddc7f871b07daf847767da.gif@1s.webp)

å¸…å“¥ï¼ˆé“ä»”ï¼‰ã€ç¾å¥³ï¼Œç‚¹ä¸ªå…³æ³¨åç»­ä¸è¿·è·¯ï¼

**æœ¬ç« ç›®å½•**

![](https://i0.hdslb.com/bfs/article/4aa545dccf7de8d4a93c2b2b8e3265ac0a26d216.png@progressive.webp)

-   0x00 åŸºç¡€ä»‹ç»
    
-   0x01 å®‰è£…ç¼–è¯‘
    

-   1.æºç ç¼–è¯‘ï¼ˆé™æ€ï¼‰
    
-   2.åˆ†å‘åŒ…å®‰è£…
    
-   3.å®¹å™¨å®‰è£…è¿è¡Œ
    

-   0x02 å¿«é€Ÿä¸Šæ‰‹
    

-   Skopeo login/loout - è¿œç¨‹ä»“åº“ Auth
    
-   Skopeo inspect - æ£€æŸ¥å­˜å‚¨åº“ä¸­çš„é•œåƒ
    
-   Skopeo copy - ä»“åº“é•œåƒæ‹·è´
    
-   Skopeo sync - é•œåƒåŒæ­¥å‘½ä»¤
    
-   Skopeo list-tags - ä»“åº“ä¸­é•œåƒtagæŸ¥çœ‹
    
-   Skopeo delete - åˆ é™¤ä»“åº“ä¸­é•œåƒTag
    
-   1.å‘½ä»¤æµ…æ
    
-   2.Skopeoåˆä½“éªŒ
    

-   0x03 é•œåƒåŒæ­¥æœ€ä½³å®è·µ
    

-   1.æŒ‡å®šæ–‡æœ¬ä¸­é•œåƒåŒæ­¥
    
-   2.ä½¿ç”¨ registry å­˜å‚¨ç‰¹æ€§åŒæ­¥
    
-   3.ä» registry å­˜å‚¨ä¸­ select å‡ºé•œåƒè¿›è¡ŒåŒæ­¥
    

![](https://i0.hdslb.com/bfs/article/4aa545dccf7de8d4a93c2b2b8e3265ac0a26d216.png@progressive.webp)

æè¿°: ä½œä¸ºå…¬å¸å†…éƒ¨ PaaS toB äº§å“çš„æ‰“åŒ…å‘å¸ƒäººå‘˜ï¼Œå®¹å™¨é•œåƒå¯¹æˆ‘ä»¬æ‰“å·¥äººè€Œè¨€å°±åƒæ˜¯å·¥åœ°ä¸Šçš„ç –å¤´ ğŸ§±ï¼Œè€Œæˆ‘çš„ä¸€éƒ¨åˆ†å·¥ä½œå°±æ˜¯å°†è¿™äº›ç –å¤´åœ¨å„ä¸ªä»“åº“ä¹‹é—´æ¬æ¥æ¬å»ï¼Œæœ€ç»ˆå°†è¿™äº›ç –å¤´æ‰“åŒ…æ”¾åœ¨äº§å“çš„å®‰è£…åŒ…ä¸­ï¼Œå½¢æˆä¸€ä¸ªå®Œæ•´çš„ PaaS äº§å“å®‰è£…åŒ…ã€‚

**Q: åœ¨ PaaS (å¹³å°å³æœåŠ¡)ä¸­çš„å¤§å®¶å¸¸è¯´çš„ToBä¸ToCåˆ°åº•æ˜¯ä»€ä¹ˆ?**

> ToC é¢å‘æ™®é€šç”¨æˆ·æœåŠ¡, ä¸»è¦æ˜¯è®©ç”¨æˆ·ä½“éªŒæ„Ÿå¥½ï¼Œè§£å†³ç”¨æˆ·ä½¿ç”¨æ–¹é¢çš„é—®é¢˜è®°å½•ï¼Œå¹¶è¿”å›ç»™å‰åç«¯å¼€å‘ã€‚  
> ToB æ˜¯é¢å‘ä¼ä¸šç”¨æˆ·æœåŠ¡, äº§å“å¯ç”¨ã€å…¶ä¸­æœ€å…³é”®æ˜¯è®©Bossä½¿ç”¨Happly!

**Q: å‡å¦‚æœ‰å¦‚ä¸‹åœºæ™¯ï¼Œæˆ‘ä»¬ä»dockerhubå…¬å…±ä»“åº“ä¸­ä¸‹è½½ä¸€ä¸ªGBä»¥ä¸Šçš„é•œåƒï¼Œåˆ°æœ¬åœ°çš„ç§æœ‰ä»“åº“ä¸­ï¼Œæˆ‘æƒ³é€šå¸¸ä½ ä¼šè¿™æ ·åšå…ˆdocker pull åˆ°æœ¬åœ°ï¼Œç„¶åä½¿ç”¨docker tagæ›´æ”¹ä¸ºç§æœ‰ä»“åº“åœ°å€åŠ ä¸Šé•œåƒåç§°ç‰ˆæœ¬ï¼Œæœ€åå†ä½¿ç”¨docker pushä¸Šä¼ é•œåƒåˆ°ç§æœ‰ä»“åº“ä¸­ï¼Œä»¥ä¾›å…¶å®ƒå†…ç½‘æœºå™¨æ‹‰å–å¹¶ä½¿ç”¨ã€‚è™½ç„¶è¯¥æ–¹æ³•æ˜¯å¯è¡Œï¼Œä½†æ˜¯å¦‚æœæœ‰å¤šä¸ªå¤§äºGBä»¥ä¸Šçš„é•œåƒéœ€è¦ä¸Šä¼ åˆ°ç§æœ‰ä»“åº“ï¼Œæ¯æ¬¡éƒ½è¦å…ˆè§£å‹layeråˆ°æœ¬åœ°ï¼Œç„¶åå†å‹ç¼©layerä¸Šä¼ åˆ°ç§æœ‰ä»“åº“ä¸­ï¼Œä½ èƒ½æƒ³è±¡æ­¤è¿‡ç¨‹èŠ±è´¹çš„æ—¶é—´æœ‰å¤šä¹…å—? å¯¹äºæˆ‘ä»¬è¿ç»´å·¥ç¨‹å¸ˆæ¥è¯´æ—¶é—´å°±æ˜¯é‡‘é’±ï¼Œæ‰€ä»¥éœ€æƒ³å°½ä¸€åˆ‡æ–¹æ³•æ¥èŠ‚çº¦æ—¶é—´æˆæœ¬ï¼Œé‚£æœ‰æ²¡æœ‰ä¸€ç§åŠæ³•å¯ä»¥ç›´æ¥å°† registry ä¸Šçš„ blob å¤åˆ¶åˆ°å¦ä¸€ä¸ª registryï¼Œä¸­é—´è¿‡ç¨‹ä¸æ¶‰åŠå¯¹é•œåƒ layer çš„è§£å‹ç¼©ï¼Œè¿™å²‚ä¸ç¾å“‰ã€‚**

> è§£å†³æ–¹æ¡ˆå½“ç„¶æ˜¯å­˜åœ¨çš„ï¼Œå¦‚æœä½ ä¸æƒ³ä½¿ç”¨dockerè¿›è¡Œimagesé•œåƒæ‹‰å–ä¸Šä¼ ï¼Œæˆ‘ä»¬å®Œæˆå¯ä»¥ä½¿ç”¨skopeå·¥å…·æ¥å®Œå…¨æ›¿ä»£ docker-cli æ¥æ¬è¿é•œåƒï¼Œskopeoæ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå®ç”¨ç¨‹åºï¼Œå¯å¯¹å®¹å™¨æ˜ åƒå’Œæ˜ åƒå­˜å‚¨åº“æ‰§è¡Œå„ç§æ“ä½œã€‚

**ä»€ä¹ˆæ˜¯Skopeo?**  
skopeo ä½¿ç”¨ API V2 Registryï¼Œä¾‹å¦‚ Docker Registryã€Atomic Registryã€ç§æœ‰Registryã€æœ¬åœ°ç›®å½•å’Œæœ¬åœ° OCI é•œåƒç›®å½•ã€‚skopeo ä¸éœ€è¦è¿è¡Œå®ˆæŠ¤è¿›ç¨‹ï¼Œå®ƒå¯ä»¥æ‰§è¡Œçš„æ“ä½œåŒ…æ‹¬ï¼š

-   é€šè¿‡å„ç§å­˜å‚¨æœºåˆ¶å¤åˆ¶é•œåƒï¼Œä¾‹å¦‚ï¼Œå¯ä»¥åœ¨ä¸éœ€è¦ç‰¹æƒçš„æƒ…å†µä¸‹å°†é•œåƒä»ä¸€ä¸ªRegistryå¤åˆ¶åˆ°å¦ä¸€ä¸ªRegistry
    
-   æ£€æµ‹è¿œç¨‹é•œåƒå¹¶æŸ¥çœ‹å…¶å±æ€§ï¼ŒåŒ…æ‹¬å…¶å›¾å±‚ï¼Œæ— éœ€å°†é•œåƒæ‹‰åˆ°æœ¬åœ°
    
-   ä»é•œåƒåº“ä¸­åˆ é™¤é•œåƒ
    
-   å½“å­˜å‚¨åº“éœ€è¦æ—¶ï¼Œskopeo å¯ä»¥ä¼ é€’é€‚å½“çš„å‡­æ®å’Œè¯ä¹¦è¿›è¡Œèº«ä»½éªŒè¯
    

**é•œåƒå­˜å‚¨ç‰¹ç‚¹**  
æ ¹æ® Robin å¤§ä½¬åœ¨ ã€Šé•œåƒä»“åº“ä¸­é•œåƒå­˜å‚¨çš„åŸç†è§£æã€‹æ–‡ç« é‡Œå¾—å‡ºçš„ç»“è®ºï¼š

-   é€šè¿‡ Registry API è·å¾—çš„ä¸¤ä¸ªé•œåƒä»“åº“ä¸­ç›¸åŒé•œåƒçš„ manifest ä¿¡æ¯å®Œå…¨ç›¸åŒã€‚
    
-   ä¸¤ä¸ªé•œåƒä»“åº“ä¸­ç›¸åŒé•œåƒçš„ manifest ä¿¡æ¯çš„å­˜å‚¨è·¯å¾„å’Œå†…å®¹å®Œå…¨ç›¸åŒã€‚
    
-   ä¸¤ä¸ªé•œåƒä»“åº“ä¸­ç›¸åŒé•œåƒçš„ blob ä¿¡æ¯çš„å­˜å‚¨è·¯å¾„å’Œå†…å®¹å®Œå…¨ç›¸åŒ
    

**é¡¹ç›®ä¿¡æ¯**  
Github å®˜æ–¹åœ°å€:Â https://github.com/containers/skopeo  
Gitee mirror:Â https://gitee.com/mirrors/skopeo

æè¿°: Skopeo å®˜æ–¹å®‰è£…&ç¼–è¯‘æ–¹å¼å‚è€ƒæ–‡æ¡£:Â https://github.com/containers/skopeo/blob/main/install.md

æœ¬èŠ‚å®‰è£…å®è·µç¯å¢ƒå°†åœ¨Ubuntu 20.04 LTS ä»¥åŠ docker 20.10.12 ä¸­è¿›è¡Œå®è·µæºç ç¼–è¯‘ä»¥åŠ apt ä»“åº“æºä¸‹è½½å®‰è£…å®è·µã€‚

æè¿°: è¦æ„å»º skopeo äºŒè¿›åˆ¶æ–‡ä»¶æ‚¨è‡³å°‘éœ€è¦ Go 1.12 ç‰ˆæœ¬ä»¥ä¸Š, å…¶æ¬¡æ„å»º skopeo æœ‰ä¸¤ç§æ–¹æ³•ï¼Œå³`åœ¨å®¹å™¨ä¸­`æˆ–è€…åœ¨æœ¬åœ°ç¯å¢ƒä¸­æ„å»º(å®‰è£…ç¯å¢ƒè¾ƒä¸ºå¤æ‚), æ­¤å¤„ä¸ºäº†æ–¹ä¾¿æ¼”ç¤ºå°†é‡‡ç”¨å®¹å™¨æ–¹å¼è¿›è¡Œç¼–è¯‘æ„å»ºã€‚

```
# 1.æ‹‰å–skopeoæºç åˆ°æœ¬åœ°
$ git clone --depth=1 https://github.com/containers/skopeo.git  # https://github.com/containers/skopeo.git
$ cd skopeo
$ sed -i 's#proxy.golang.org#https://goproxy.cn#g' skopeo/Makefile

# 2.ä¸‹è½½é•œåƒæ„å»ºä¾èµ–
$ sudo apt-get install go-md2man  # æ„å»ºæ‰‹å†Œä¾èµ–äº go-md2manã€‚
$ whereis go-md2man  # è·å¾—æœ¬æœºä¸­go-md2manè·¯å¾„ã€‚

# 3.æ„å»ºé™æ€äºŒè¿›åˆ¶æ–‡ä»¶
$ BUILD_IMAGE="golang:latest"
$ docker run --name skopeo-build -v $PWD:/src -v /usr/bin/go-md2man:/go/bin/go-md2man -w /src -e CGO_ENABLED=0 -e GOPROXY=https://goproxy.cn,direct ${BUILD_IMAGE} \
sh -c 'make BUILDTAGS=containers_image_openpgp GO_DYN_FLAGS='
  # CGO_CFLAGS="" CGO_LDFLAGS="" GO111MODULE=on go build -mod=vendor  -ldflags '-X main.gitCommit=df4d82b960572c19e9333381a203c0ac475766d7 ' -gcflags "" -tags  "containers_image_openpgp" -o bin/skopeo ./cmd/skopeo

# 4.è¿è¡Œç¼–è¯‘ç”Ÿæˆçš„skopeoå¯æ‰§è¡Œæ–‡ä»¶
$ cd ./bin # /opt/software/skopeo/bin
$ ./skopeo --help
  # Various operations with container images and container image registries
  # .......
  # Use "skopeo [command] --help" for more information about a command.
```

**æ„å»ºå…³é”®å‚æ•°è§£æ:**

-   CGO\_ENABLED=0 : è®¾ç½®è¯¥ç¯å¢ƒå˜é‡, ç¦ç”¨ CGO ä¼šå¯¼è‡´ Go åœ¨å¯èƒ½çš„æƒ…å†µä¸‹æ›´å–œæ¬¢é™æ€è¿æ¥åº“ï¼Œè€Œä¸æ˜¯åŠ¨æ€é“¾æ¥åˆ°ç³»ç»Ÿåº“ (è§£å†³å¯ä»¥åœ¨Ubuntuæˆ–è€…å…¶å®ƒlinuxå‘è¡Œç‰ˆä¸­æ‰§è¡Œç¼–è¯‘åäºŒè¿›åˆ¶æ–‡ä»¶)ã€‚
    
-   GOPROXY=https://goproxy.cn,direct : Golong ä¾èµ–ä¸‹è½½é•œåƒç«™,åŠ å¿«go getä¾èµ–æ‹‰æ‹‰å–ã€‚
    
-   BUILDTAGS=containers\_image\_openpgp : è®¾ç½®è¯¥makeå‚æ•°æ¶ˆé™¤äº†å¯¹libgpgme åŠå…¶é…å¥—åº“çš„ä¾èµ–, Skopeo çš„ä¸€äº›ç‰¹æ€§ä¾èµ–äºé Go åº“ï¼Œä¾‹å¦‚ libgpgme å’Œ libdevmapperã€‚
    
-   GO\_DYN\_FLAGS= : æ¸…ç©ºè¯¥makeå‚æ•° (å¦åˆ™ä¼šå¼ºåˆ¶åˆ›å»ºåŠ¨æ€å¯æ‰§è¡Œæ–‡ä»¶)
    

æè¿°: skopeo å¯èƒ½å·²ç»æ‰“åŒ…åœ¨æ‚¨çš„å‘è¡Œç‰ˆä¸­ï¼Œæ­¤å¤„ä»¥ubuntu 20.04ä¸ºä¾‹è¿›è¡Œå®‰è£…ã€‚

```
# 1.åªæ”¯æŒ Ubuntu 20.10 and newer å‘è¡Œç‰ˆ 
sudo apt-get -y update
sudo apt-get -y install skopeo

# 2.ä½† Kubic é¡¹ç›®ä¸º Ubuntu 20.04 æä¾›äº†è½¯ä»¶åŒ…ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼åœ¨æˆ‘ä»¬åŠå…¶ä¸Šè¿›è¡Œå®‰è£…ã€‚
. /etc/os-release
echo "deb https://download.opensuse.org/repositories/devel:/kubic:/libcontainers:/stable/xUbuntu_${VERSION_ID}/ /" | sudo tee /etc/apt/sources.list.d/devel:kubic:libcontainers:stable.list
curl -L https://download.opensuse.org/repositories/devel:/kubic:/libcontainers:/stable/xUbuntu_${VERSION_ID}/Release.key | sudo apt-key add -
sudo apt-get update
sudo apt-get -y upgrade
sudo apt-get -y install skopeo
```

Skopeo å®¹å™¨é•œåƒå¯åœ¨Â quay.io/skopeo/stable:latestÂ è·å¾—, ä¾‹å¦‚æˆ‘ä»¬é‡‡ç”¨podmanå‘½ä»¤è¿›è¡Œå¦‚ä¸‹æ“ä½œ:

podman run docker://quay.io/skopeo/stable:latest copy --help  

æè¿°: skopen æ˜¯æ“ä½œå„ç§å®¹å™¨æ˜ åƒå’Œå®¹å™¨æ˜ åƒä»“åº“çš„å·¥å…·ï¼Œå…¶ä½¿ç”¨æ–¹æ³•åŠå…¶å¯ç”¨å‘½ä»¤å¦‚ä¸‹:

```
./skopeo --help    # å­å‘½ä»¤å¯é‡‡ç”¨å¦‚ä¸‹å‘½ä»¤ skopeo [command] --help å‘½ä»¤
Usage:
  skopeo [flags]
  skopeo [command]
Available Commands: 
  copy          # å¤åˆ¶ä¸€ä¸ªé•œåƒä» A åˆ° Bï¼Œè¿™é‡Œçš„ A å’Œ B å¯ä»¥ä¸ºæœ¬åœ° docker é•œåƒæˆ–è€… registry ä¸Šçš„é•œåƒï¼›
  delete        # åˆ é™¤ä¸€ä¸ªé•œåƒ tagï¼Œå¯ä»¥æ˜¯æœ¬åœ° docker é•œåƒæˆ–è€… registry ä¸Šçš„é•œåƒï¼›
  help          # å¸®åŠ©æŸ¥çœ‹
  inspect       # æŸ¥çœ‹ä¸€ä¸ªé•œåƒçš„ manifest æˆ–è€… image config è¯¦ç»†ä¿¡æ¯ï¼›
  list-tags     # åˆ—å‡ºå­˜å‚¨åº“åç§°æŒ‡å®šçš„é•œåƒçš„tag
  login           # ç™»é™†æŸä¸ªé•œåƒä»“åº“,ç±»ä¼¼äº docker login å‘½ä»¤
  logout          # é€€å‡ºæŸä¸ªå·²è®¤è¯çš„é•œåƒä»“åº“, ç±»ä¼¼äº docker logout å‘½ä»¤
  manifest-digest # è®¡ç®—æ–‡ä»¶çš„æ¸…å•æ‘˜è¦æ˜¯ä¸€ä¸ªsha256sum å€¼
  standalone-sign   # ä½¿ç”¨æœ¬åœ°æ–‡ä»¶åˆ›å»ºç­¾å
  standalone-verify # éªŒè¯æœ¬åœ°æ–‡ä»¶çš„ç­¾å
  sync              # å°†ä¸€ä¸ªæˆ–å¤šä¸ªå›¾åƒä»ä¸€ä¸ªä½ç½®åŒæ­¥åˆ°å¦ä¸€ä¸ªä½ç½® (è¯¥åŠŸèƒ½éå¸¸Nice)
Flags:
    --command-timeout duration   # å‘½ä»¤è¶…æ—¶æ—¶é—´(å•ä½ç§’)
    --debug                      # å¯ç”¨debugæ¨¡å¼
    --insecure-policy            # åœ¨ä¸è¿›è¡Œä»»ä½•ç­–ç•¥æ£€æŸ¥çš„æƒ…å†µä¸‹è¿è¡Œè¯¥å·¥å…·ï¼ˆå¦‚æœæ²¡æœ‰é…ç½® policy çš„è¯éœ€è¦åŠ ä¸Šè¯¥å‚æ•°ï¼‰
    --override-arch ARCH         # å¤„ç†é•œåƒæ—¶è¦†ç›–å®¢æˆ·ç«¯ CPU ä½“ç³»æ¶æ„ï¼Œå¦‚åœ¨ amd64 çš„æœºå™¨ä¸Šç”¨ skopeo å¤„ç† arm64 çš„é•œåƒ
    --override-os OS             # å¤„ç†é•œåƒæ—¶è¦†ç›–å®¢æˆ·ç«¯ OS
    --override-variant VARIANT   # å¤„ç†é•œåƒæ—¶ä½¿ç”¨VARIANTè€Œä¸æ˜¯è¿è¡Œæ¶æ„å˜é‡
    --policy string              # ä¿¡ä»»ç­–ç•¥æ–‡ä»¶çš„è·¯å¾„ (ä¸ºé•œåƒé…ç½®å®‰å…¨ç­–ç•¥æƒ…å†µä¸‹ä½¿ç”¨)
    --registries.d DIR           # åœ¨ç›®å½•ä¸­ä½¿ç”¨Registryé…ç½®æ–‡ä»¶ï¼ˆä¾‹å¦‚ï¼Œç”¨äºå®¹å™¨ç­¾åå­˜å‚¨ï¼‰
    --tmpdir string              # ç”¨äºå­˜å‚¨ä¸´æ—¶æ–‡ä»¶çš„ç›®å½•
-h, --help                       help for skopeo 
-v, --version                    Version for Skopeo
```

æè¿°: åœ¨ä½¿ç”¨ä½“éªŒskopeoä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ä¸€å“ˆ Skopeo å¯ä»¥åœ¨é‚£äº›å›¾åƒå’Œå­˜å‚¨åº“ç±»å‹ä¸Šæ‰§è¡Œé•œåƒæ“ä½œ(å®˜ç½‘æ–‡æ¡£èµ°ä¸€æ³¢)ï¼š

![](https://i0.hdslb.com/bfs/article/21861e51e100fd3a47f2473c5620918c667939dc.png@942w_204h_progressive.webp)

æ¸©é¦¨æç¤º: åŒä¸€ä¸ªé•œåƒå­˜åœ¨çš„æ–¹å¼æœ‰å¯èƒ½ä¸åŒï¼Œä¸åŒç±»å‹æ–¹å¼å­˜å‚¨å¯¹é•œåƒçš„ layer å¤„ç†çš„æ–¹å¼ä¹Ÿä¸ä¸€æ ·,ã€‚

**æµ‹è¯•ç¯å¢ƒè¯´æ˜**

```
Docker å®˜æ–¹ hub ä»“åº“ -> docker.io             # å®˜ç½‘åœ°å€: https://hub.docker.com/
ç§æœ‰ Harbor ä»“åº“     -> harbor.weiyigeek.top
ä¸´æ—¶åˆ›å»ºçš„æœ¬åœ°ä»“åº“    -> 192.168.12.111:5000   # ä¸€æ¢­å­è§£å†³: docker run -d -p 5000:5000 --name registry -v /opt/data/registry:/var/lib/registry registry:2 
```

è¯´æ˜: ä¸Šè¿°ä»“åº“éƒ½æ˜¯åœ¨Registryä¸­æ”¯æŒDocker Registry HTTP API V2ç‰ˆæœ¬çš„ã€‚

æè¿°: åœ¨ä½¿ç”¨ skopeo å‰å¦‚æœ src æˆ– dest é•œåƒæ˜¯åœ¨ registry ä»“åº“ä¸­çš„å¹¶ä¸”é…ç½®äº†é public çš„é•œåƒéœ€è¦ç›¸åº”çš„ auth è®¤è¯, æ­¤æ—¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Â `docker login`Â æˆ–è€…Â `skopeo login`Â çš„æ–¹å¼ç™»å½•åˆ° registry ä»“åº“ï¼Œç„¶åé»˜è®¤ä¼šåœ¨`~/.docker`ç›®å½•ä¸‹ç”Ÿæˆ registry ç™»å½•é…ç½®æ–‡ä»¶ config.json ,è¯¥æ–‡ä»¶é‡Œä¿å­˜äº†ç™»å½•éœ€è¦çš„éªŒè¯ä¿¡æ¯ï¼Œskopeo æ‹¿åˆ°è¯¥éªŒè¯ä¿¡æ¯æ‰æœ‰æƒé™å¾€ registry push é•œåƒã€‚

**ç™»é™†è®¤è¯**

```
# (1) skopeo login ç™»é™†ç¤ºä¾‹ (ä¸¤ç§æ–¹å¼)
$ skopeo login -u WeiyiGeek -p testpassword harbor.weiyigeek.top
  # Login Succeeded!

# (2) docker login ç™»é™†ç¤ºä¾‹
docker login -u WeiyiGeek docker.io
docker login -u WeiyiGeek harbor.weiyigeek.top
docker login -u anonymous -p anonymous 192.168.12.111:5000  # å®é™…ä¸Šä¸´æ—¶ä»“åº“æ²¡æœ‰é…ç½®è®¤è¯, è´¦å·å¯†ç éšæ„å³å¯ã€‚
  # WARNING! Using --password via the CLI is insecure. Use --password-stdin.
  # WARNING! Your password will be stored unencrypted in /root/.docker/config.json.
  # Configure a credential helper to remove this warning. See
  # https://docs.docker.com/engine/reference/commandline/login/#credentials-store
  # Login Succeeded

# (3) docker login ç”Ÿæˆçš„ registry ç™»å½•é…ç½®æ–‡ä»¶ï¼ˆbase64ç¼–ç å®‰å…¨æ€§ä¸å¤šè¯´ï¼‰
cat ~/.docker/config.json
{
  "auths": {
    "192.168.12.111:5000": {
        "auth": "YW5v*******Q=="
      },
    "harbor.weiyigeek.top": {
        "auth": "YWR*******LkA="
      },
    "https://index.docker.io/v1/": {
        "auth": "d2Vp**************kyZA=="
    }
  }
}
```

**æ³¨é”€è®¤è¯**

$ skopeo logout myregistrydomain.com:5000

**æ¸©é¦¨æç¤º:**Â å¦‚æœä¼ä¸šè‡ªå»ºharborä»“åº“(ä¸€èˆ¬éƒ½ä¼šè®¾ç½®è‡ªç­¾è¯ä¹¦)æˆ–è€…å…¶å®ƒç§æœ‰ä»“åº“é…ç½®è¯ä¹¦,ä¸ºäº†é˜²æ­¢å‡ºé”™å»ºè®®è¿›è¡Œä»¥ä¸‹æ“ä½œ(æ­£å¼ç¯å¢ƒè¯·æ ¹æ®éœ€è¦è¿›è¡Œé…ç½®)ã€‚

```
# (1) åœ¨ /etc/docker/daemon.json ä¸­é…ç½®insecure-registrieså­—æ®µ,è¡¨ç¤ºå…è®¸ä¸å®‰å…¨çš„ä»“åº“ã€‚
"insecure-registries": ["harbor.weiyigeek.top","192.168.12.111:5000"]
 
# (2) ä»å®˜æ–¹æ–‡æ¡£å¯çŸ¥å®¢æˆ·ç«¯è¦ä½¿ç”¨tlsä¸Harboré€šä¿¡ä½¿ç”¨çš„è¿˜æ˜¯`è‡ªç­¾è¯ä¹¦`ï¼Œé‚£ä¹ˆå¿…é¡»å»ºç«‹ä¸€ä¸ªç›®å½•ï¼š`/etc/docker/certs.d`
# å¦‚æœé…ç½®å¯èƒ½ä¼šå‡ºç° x509: certificate signed by unknown authority é”™è¯¯æç¤ºã€‚
mkdir -vp /etc/docker/certs.d/harbor.weiyigeek.top
cp -a /deployapp/harbor/harbor.pem  /etc/docker/certs.d/harbor.weiyigeek.top/harbor.crt
```

**æ¸©é¦¨æç¤º:**Â ä¸ºäº†é˜²æ­¢åç»­æ‰§è¡Œskopeoå‘½ä»¤æ“ä½œé•œåƒæ—¶å‡ºé”™, å»ºè®®å¿½ç•¥policyç­–ç•¥å’Œè¯ä¹¦æ ¡éªŒå‚æ•°å¦‚ä¸‹:

```
--insecure-policy \
--src-tls-verify=false \ 
--dest-tls-verify=false \
```

æè¿°: skopeo èƒ½å¤Ÿæ£€æŸ¥å®¹å™¨Registryä¸Šçš„å­˜å‚¨åº“å¹¶è·å–å›¾åƒå±‚ã€‚æ£€æŸ¥å‘½ä»¤è·å–å­˜å‚¨åº“çš„æ¸…å•ï¼Œå®ƒèƒ½å¤Ÿå‘æ‚¨æ˜¾ç¤ºæœ‰å…³æ•´ä¸ªå­˜å‚¨åº“æˆ–æ ‡ç­¾çš„ç±»ä¼¼Â `docker inspect`Â çš„ json è¾“å‡ºã€‚ä¸ docker inspect ç›¸æ¯”,æ­¤å·¥å…·å¯å¸®åŠ©æ‚¨åœ¨æ‹‰å–å­˜å‚¨åº“æˆ–æ ‡ç­¾ä¹‹å‰æ”¶é›†æœ‰ç”¨çš„ä¿¡æ¯(ä½¿ç”¨ç£ç›˜ç©ºé—´), æ£€æŸ¥å‘½ä»¤å¯ä»¥å‘æ‚¨æ˜¾ç¤ºç»™å®šå­˜å‚¨åº“å¯ç”¨çš„æ ‡ç­¾ã€æ˜ åƒå…·æœ‰çš„æ ‡ç­¾ã€æ˜ åƒçš„åˆ›å»ºæ—¥æœŸå’Œæ“ä½œç³»ç»Ÿç­‰ã€‚

æ”¯æŒä¼ è¾“çš„ç±»å‹ :Â `containers-storage, dir, docker, docker-archive, docker-daemon, oci, oci-archive, ostree, tarball`

æ­¥éª¤ 01.æ˜¾ç¤º busybox:latest é•œåƒçš„å±æ€§ç›¸å…³ä¿¡æ¯ã€‚

```
skopeo inspect docker://docker.io/busybox:latest
{
  "Name": "docker.io/library/busybox",
  "Digest": "sha256:5acba83a746c7608ed544dc1533b87c737a0b0fb730301639a0179f9344b1678",
  "RepoTags": [
      "1",
      "1-glibc",
      "1-musl",
      "1-ubuntu",
      "1-uclibc",
      "1.21-ubuntu",
      "1.21.0-ubuntu",
        .......          # é•œåƒå†å²tags
      "unstable-uclibc"
  ],
  "Created": "2021-12-30T19:19:41.006954958Z",
  "DockerVersion": "20.10.7",
  "Labels": null,
  "Architecture": "amd64",
  "Os": "linux",
  "Layers": [
      "sha256:5cc84ad355aaa64f46ea9c7bbcc319a9d808ab15088a27209c9e70ef86e5a2aa"
  ],
  "Env": [
      "PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"
  ]
}
```

æ­¥éª¤ 02.æ˜¾ç¤º busybox:latest é•œåƒçš„å®¹å™¨é…ç½®ç›¸å…³ä¿¡æ¯ã€‚

```
$ skopeo inspect --config docker://docker.io/busybox:latest  | jq
{
  "created": "2021-12-30T19:19:41.006954958Z",
  "architecture": "amd64",
  "os": "linux",
  "config": {
    "Env": [
      "PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"
    ],
    "Cmd": [
      "sh"
    ]
  },
  "rootfs": {
    "type": "layers",
    "diff_ids": [
      "sha256:01fd6df81c8ec7dd24bbbd72342671f41813f992999a3471b9d9cbc44ad88374"
    ]
  },
  "history": [
    {
      "created": "2021-12-30T19:19:40.833034683Z",
      "created_by": "/bin/sh -c #(nop) ADD file:6db446a57cbd2b7f4cfde1f280177b458390ed5a6d1b54c6169522bc2c4d838e in / "
    },
    {
      "created": "2021-12-30T19:19:41.006954958Z",
      "created_by": "/bin/sh -c #(nop)  CMD [\"sh\"]",
      "empty_layer": true
    }
  ]
}
```

æ­¥éª¤ 03.æ˜¾ç¤ºæœªç»éªŒè¯çš„å›¾åƒ Digestï¼ˆæ‘˜è¦ï¼‰

```
$ skopeo inspect --format "Name: {{.Name}} Digest: {{.Digest}}" docker://docker.io/busybox:latest
```

æè¿°: skopeo å¯ä»¥åœ¨å„ç§å­˜å‚¨æœºåˆ¶ä¹‹é—´å¤åˆ¶å®¹å™¨é•œåƒï¼Œæ”¯æŒåŒ…æ‹¬å®¹å™¨ä»“åº“(`The Quay, Docker Hub, OpenShift, GCR, ï¼ŒArtifactory ...`)ä»¥åŠå®¹å™¨å­˜å‚¨åç«¯ (`Podman, CRI-O, Docker`) ç­‰ã€æœ¬åœ°ç›®å½•ã€æœ¬åœ° OCI-layout ç›®å½•ã€‚

ä¾‹å¦‚ï¼Œæ­¤å¤„æˆ‘ä»hubä»“åº“å¤åˆ¶`busybox:latest`é•œåƒåˆ°ç§æœ‰harbotä»“åº“ä¸­,åœ¨ä»ç§æœ‰harbotä»“åº“ä¸­æ‹·è´åˆ°æœ¬åœ°æŒ‡å®šç›®å½•ä¸­ã€‚

æ­¥éª¤ 01.ä» regsitry A åˆ° registry B å¤åˆ¶ busybox:latest é•œåƒã€‚

```
skopeo copy --insecure-policy --src-tls-verify=false --dest-tls-verify=false --dest-authfile /root/.docker/config.json docker://docker.io/busybox:latest docker://harbor.weiyigeek.top/devops/busybox:latest
  # Getting image source signatures
  # Copying blob 5cc84ad355aa done
  # Copying config beae173cca done
  # Writing manifest to image destination
  # Storing signatures
```

Tips: ç”±ä¸Šè¿°æ—¥å¿—å¯ä»¥çœ‹åˆ° skopeo æ˜¯ç›´æ¥ä» registry ä¸­ copy é•œåƒ layer çš„ blob æ–‡ä»¶ï¼Œä¼ è¾“æ˜¯é•œåƒåœ¨ registry ä¸­å­˜å‚¨çš„åŸå§‹æ ¼å¼ã€‚

æ­¥éª¤ 02.ä» registry B å¤åˆ¶ busybox:latest é•œåƒåˆ°æœ¬åœ° busybox:latest ç›®å½•ä¸­ã€‚

```
skopeo copy --insecure-policy --src-tls-verify=false docker://harbor.weiyigeek.top/devops/busybox:latest dir:busybox:latest
# Getting image source signatures
# Copying blob 5cc84ad355aa done
# Copying config beae173cca done
# Writing manifest to image destination
# Storing signatures

ls && tree busybox\:latest/
busybox:latest/
â”œâ”€â”€ 5cc84ad355aaa64f46ea9c7bbcc319a9d808ab15088a27209c9e70ef86e5a2aa   # blob å—æ–‡ä»¶ -> vnd.docker.image.rootfs.diff.tar.gzip
â”œâ”€â”€ beae173ccac6ad749f76713cf4440fe3d21d1043fe616dfbe30775815d1d0f6a   # é•œåƒé…ç½®ä¿¡æ¯æ–‡ä»¶ -> vnd.docker.container.image.v1+json 
â”œâ”€â”€ manifest.json
â””â”€â”€ version
0 directories, 4 files

# æŸ¥çœ‹é•œåƒçš„ manifest æ–‡ä»¶
cat busybox\:latest/manifest.json
{
   "schemaVersion": 2,
   "mediaType": "application/vnd.docker.distribution.manifest.v2+json",
   "config": {
      "mediaType": "application/vnd.docker.container.image.v1+json",
      "size": 1456,
      "digest": "sha256:beae173ccac6ad749f76713cf4440fe3d21d1043fe616dfbe30775815d1d0f6a"
   },
   "layers": [
      {
         "mediaType": "application/vnd.docker.image.rootfs.diff.tar.gzip",
         "size": 772788,
         "digest": "sha256:5cc84ad355aaa64f46ea9c7bbcc319a9d808ab15088a27209c9e70ef86e5a2aa"
      }
   ]
}

# æ ¹æ® manifest æ–‡ä»¶æŸ¥çœ‹é•œåƒçš„ image config æ–‡ä»¶ (å­˜æ”¾é•œåƒBuildæŒ‡ä»¤ä¸é•œåƒç›¸å…³é…ç½®ä¿¡æ¯)
jq '.' busybox\:latest/beae173ccac6ad749f76713cf4440fe3d21d1043fe616dfbe30775815d1d0f6a
{
  "architecture": "amd64",
  "config": {
    "Hostname": "",
    "Domainname": "",
    "User": "",
    "AttachStdin": false,
    "AttachStdout": false,
    "AttachStderr": false,
    "Tty": false,
    "OpenStdin": false,
    "StdinOnce": false,
    "Env": [
      "PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"
    ],
    "Cmd": [
      "sh"
    ],
    "Image": "sha256:da658412c37aa24e561eb7e16c61bc82a9711340d8fb5cf1a8f39d8e96d7f723",
    "Volumes": null,
    "WorkingDir": "",
    "Entrypoint": null,
    "OnBuild": null,
    "Labels": null
  },
........
  "history": [
    {
      "created": "2021-12-30T19:19:40.833034683Z",
      "created_by": "/bin/sh -c #(nop) ADD file:6db446a57cbd2b7f4cfde1f280177b458390ed5a6d1b54c6169522bc2c4d838e in / "
    },
    {
      "created": "2021-12-30T19:19:41.006954958Z",
      "created_by": "/bin/sh -c #(nop)  CMD [\"sh\"]",
      "empty_layer": true
    }
  ],
  "os": "linux",
  "rootfs": {
    "type": "layers",
    "diff_ids": [
      "sha256:01fd6df81c8ec7dd24bbbd72342671f41813f992999a3471b9d9cbc44ad88374"
    ]
  }

}
```

æ­¥éª¤ 03.å°†busybox:latesté•œåƒä» registry B å¤åˆ¶åˆ°æœ¬åœ°ç›®å½•ï¼Œå¹¶ä»¥ OCI æ ¼å¼ä¿å­˜

```
$ skopeo copy --insecure-policy --src-tls-verify=false docker://harbor.weiyigeek.top/devops/busybox:latest oci:busybox-latest
  # Getting image source signatures
  # Copying blob 5cc84ad355aa done
  # Copying config 48edd9298a done
  # Writing manifest to image destination
  # Storing signatures

tree -h busybox-latest/
  # busybox-latest/
  # â”œâ”€â”€ [4.0K]  blobs
  # â”‚   â””â”€â”€ [4.0K]  sha256
  # â”‚       â”œâ”€â”€ [ 347]  1612e16ff3f6b0d09eefdc4e9d5c5c0624f63032743e016585b095b958778016
  # â”‚       â”œâ”€â”€ [ 575]  48edd9298a25de2c97cd574a5523026f87576c6b7202330a2b60ce7d304ec307
  # â”‚       â””â”€â”€ [755K]  5cc84ad355aaa64f46ea9c7bbcc319a9d808ab15088a27209c9e70ef86e5a2aa  # Blob å— -
  # â”œâ”€â”€ [ 186]  index.json
  # â””â”€â”€ [  31]  oci-layout
  # 2 directories, 5 files
```

æ­¥éª¤ 04.å°†Â `alpine:3.13.1`Â é•œåƒä» docker æœ¬åœ°å­˜å‚¨ï¼ˆ /var/lib/docker/imageï¼‰ push åˆ° registry Bä¸­(å®é™…ä¸Šæ›¿ä»£ docker push åŠŸèƒ½)

```
# åœ¨  /var/lib/docker/ ç›®å½•ä¸­æ­¤å¤„ä¸»è¦å…³å¿ƒ image (ä¸»è¦å­˜æ”¾é•œåƒä¸­layerå±‚çš„å…ƒæ•°æ®) å’Œ overlay2 (å„å±‚çš„å…·ä½“ä¿¡æ¯)
docker images alpine:3.13.1
  # REPOSITORY   TAG       IMAGE ID       CREATED         SIZE
  # alpine       3.13.1    e50c909a8df2   11 months ago   5.61MB

skopeo copy --insecure-policy --dest-tls-verify=false --dest-authfile /root/.docker/config.json docker-daemon:alpine:3.13.1 docker://harbor.weiyigeek.top/devops/alpine:3.13.1
  # Getting image source signatures
  # Copying blob 1119ff37d4a9 done
  # Copying config e50c909a8d done
  # Writing manifest to image destination
  # Storing signatures
```

![WeiyiGeek.harborä»“åº“ä¸­çš„alpineé•œåƒ](https://i0.hdslb.com/bfs/article/348f96c66b0150cd75cd59ac93004969cc3daecb.png@942w_492h_progressive.webp)

æè¿°: Skopeo syncå¯ä»¥åœ¨å®¹å™¨ä»“åº“å’Œæœ¬åœ°ç›®å½•ä¹‹é—´åŒæ­¥é•œåƒï¼Œå…¶åŠŸèƒ½ç±»ä¼¼äºé˜¿é‡Œäº‘çš„ image-syncer (https://github.com/AliyunContainerService/image-syncer) å·¥å…·, å®é™…ä¸Šå…¶æ¯” image-syncer æ›´å¼ºå¤§ã€çµæ´»æ€§æ›´å¼ºä¸€äº›ï¼ŒåºŸè¯ä¸å¤šè¯´å®è·µä¸ºç‹ã€‚

skopeo sync é•œåƒåŒæ­¥æ–‡ä»¶ç¤ºä¾‹:

æ­¥éª¤ 01.å°†ä»“åº“ä¸­æ‰€æœ‰busyboxé•œåƒç‰ˆæœ¬åŒæ­¥åˆ°æœ¬åœ°ç›®å½•ã€‚

```
$ skopeo sync --insecure-policy --src-tls-verify=false --src docker --dest dir harbor.weiyigeek.top/devops/busybox /tmp
  # INFO[0000] Tag presence check                            imagename=harbor.weiyigeek.top/devops/busybox tagged=false
  # INFO[0000] Getting tags                                  image=harbor.weiyigeek.top/devops/busybox
  # INFO[0000] Copying image ref 1/1                         from="docker://harbor.weiyigeek.top/devops/busybox:latest" to="dir:/tmp/busybox:latest"
  # Getting image source signatures
  # Copying blob 5cc84ad355aa done
  # Copying config beae173cca done
  # Writing manifest to image destination
  # Storing signatures
  # INFO[0000] Synced 1 images from 1 sources

$ tree -h /tmp/busybox:latest
/tmp/busybox:latest
â”œâ”€â”€ [755K]  5cc84ad355aaa64f46ea9c7bbcc319a9d808ab15088a27209c9e70ef86e5a2aa
â”œâ”€â”€ [1.4K]  beae173ccac6ad749f76713cf4440fe3d21d1043fe616dfbe30775815d1d0f6a
â”œâ”€â”€ [ 527]  manifest.json
â””â”€â”€ [  33]  version
0 directories, 4 files
```

æ­¥éª¤ 02.ä»æœ¬åœ°ç›®å½•`/tmp/`åŒæ­¥åˆ° docker çš„ hub å®¹å™¨ä»“åº“ä¸­ï¼Œæ­¤å¤–æˆ‘ä»¬å¯ä»¥é€šè¿‡æµè§ˆå™¨çœ‹åˆ°Â `weiyigeek`Â ç”¨æˆ·ä¸‹çš„Â `busybox`Â é•œåƒ (https://hub.docker.com/u/weiyigeek)ã€‚

```
$ skopeo sync --insecure-policy --dest-tls-verify=false --src dir --dest docker /tmp weiyigeek
  # INFO[0000] Copying image ref 1/1                         from="dir:/tmp/busybox:latest" to="docker://weiyigeek/busybox:latest"
  # Getting image source signatures
  # Copying blob 5cc84ad355aa skipped: already exists
  # Copying config beae173cca done
  # Writing manifest to image destination
  # Storing signatures
  # INFO[0021] Synced 1 images from 1 sources
```

![WeiyiGeek.hub-docker](https://i0.hdslb.com/bfs/article/31bfb07cee8ac94a0dac3967615b8802788004a1.png@942w_728h_progressive.webp)

æ­¥éª¤ 03.ä»hubå®¹å™¨ä»“åº“ä¸­åŒæ­¥alpine-jenkins-jnlp:v2.285é•œåƒåˆ°æœ¬åœ°ä¸´æ—¶å®¹å™¨ä»“åº“ä¸­ã€‚

```
$ skopeo sync --insecure-policy --src-tls-verify=false --dest-tls-verify=false --src docker --dest docker weiyigeek/alpine-jenkins-jnlp:v2.285 192.168.12.111:5000/
  # INFO[0000] Tag presence check imagename="weiyigeek/alpine-jenkins-jnlp:v2.285" tagged=true
  # INFO[0000] Copying image ref 1/1 from="docker://weiyigeek/alpine-jenkins-jnlp:v2.285" to="docker://192.168.12.111:5000/alpine-jenkins-jnlp:v2.285"
  # Getting image source signatures
  # Copying blob 68517a8c32d3 [======>-------------------------------] 45.0MiB / 255.7MiB
  # Copying blob 4c0d98bf9879 done
```

æ­¥éª¤ 04.ä»¥é…ç½®æ–‡ä»¶æ–¹å¼è¿›è¡ŒåŒæ­¥, é¦–å…ˆæˆ‘ä»¬éœ€è¦å‡†å¤‡ä¸€ä¸ªéœ€è¦åŒæ­¥çš„èµ„æºæ¸…å•ã€‚

```
# YAML æ–‡ä»¶å†…å®¹ï¼ˆç”¨äº **--src yaml** çš„æºï¼‰
cat <<'EOF' > skopeo-sync.yml
registry.example.com:
  images:
    busybox: []
    redis:
      - "1.0"
      - "2.0"
      - "sha256:111111"
  images-by-tag-regex:
      nginx: ^1\.13\.[12]-alpine-perl$
  credentials:
      username: john
      password: this is a secret
  tls-verify: true
  cert-dir: /home/john/certs
quay.io:
  tls-verify: false
  images:
    coreos/etcd:
      - latest
EOF

# ä»¥yamlæ–‡ä»¶æ–¹å¼è¿›è¡ŒåŒæ­¥é•œåƒåˆ° my-registry.local.lan/repo/ ä»“åº“ä¸­
$ skopeo sync --src yaml --dest docker skopeo-sync.yml my-registry.local.lan/repo/
```

skopeo-sync.yml æ–‡ä»¶ä¸­é•œåƒåŒ¹é…å¤åˆ¶é•œåƒè¯´æ˜:

-   registry.example.com/busyboxÂ : æ‰€æœ‰ç‰ˆæœ¬çš„é•œåƒ.
    
-   registry.example.com/redisÂ : æ ‡è®°ä¸ºâ€œ1.0â€å’Œâ€œ2.0â€çš„å›¾åƒä»¥åŠå¸¦æœ‰æ‘˜è¦çš„å›¾åƒ"sha256:0000000000000000000000000000000011111111111111111111111111111111".
    
-   registry.example.com/nginxÂ : å›¾ç‰‡æ ‡è®°ä¸ºâ€œ1.13.1-alpine-perlâ€å’Œâ€œ1.13.2-alpine-perlâ€.
    
-   quay.io/coreos/etcdÂ : æ‹‰å–æœ€æ–°ç‰ˆæœ¬çš„é•œåƒã€‚
    

æè¿°: åˆ©ç”¨è¯¥å‘½ä»¤æˆ‘ä»¬å¯ä»¥åˆ—å‡º registry ä¸Šçš„æŸä¸ªé•œåƒçš„æ‰€æœ‰ tag ï¼Œå®ƒæ˜¯ä½¿ç”¨æ ‡å‡†çš„ registry API æ¥è·å–é•œåƒ tagã€‚

ç®€å•ç¤ºä¾‹:

```
$ skopeo list-tags docker://harbor.weiyigeek.top/devops/busybox:latest
```

æè¿°: ä½¿ç”¨è¯¥å‘½ä»¤æˆ‘ä»¬å¯ä»¥åˆ é™¤é•œåƒTag,æ³¨æ„æ­¤å¤„ä»…ä»…åªæ˜¯é€šè¿‡registry API æ¥åˆ é™¤é•œåƒçš„ tagï¼ˆå³åˆ é™¤äº† tag å¯¹ manifests æ–‡ä»¶çš„å¼•ç”¨ï¼‰å¹¶éçœŸæ­£å°†é•œåƒåˆ é™¤æ‰ï¼Œå¦‚æœæƒ³è¦åˆ é™¤é•œåƒçš„ layer è¿˜æ˜¯éœ€è¦é€šè¿‡ registry GC çš„æ–¹å¼ã€‚

```
# æ–¹å¼1.åˆ©ç”¨skopeo delete
$ skopeo delete docker://harbor.weiyigeek.top/devops/busybox:latest --debug
  # DEBU[0000] Loading registries configuration "/etc/containers/registries.conf"
  # DEBU[0000] Found credentials for harbor.weiyigeek.top in credential helper containers-auth.json in file /home/weiyigeek/.docker/config.json
  # DEBU[0000] Using registries.d directory /etc/containers/registries.d for sigstore configuration
  # DEBU[0000]  No signature storage configuration found for harbor.weiyigeek.top/devops/busybox:latest, using built-in default file:///home/weiyigeek/.local/share/containers/sigstore
  # DEBU[0000] Looking for TLS certificates and private keys in /etc/docker/certs.d/harbor.weiyigeek.top
  # DEBU[0000]  crt: /etc/docker/certs.d/harbor.weiyigeek.top/harbor.crt
  # DEBU[0000] GET https://harbor.weiyigeek.top/v2/
  # DEBU[0000] Ping https://harbor.weiyigeek.top/v2/ status 401
  # DEBU[0000] GET https://harbor.weiyigeek.top/service/token?account=WeiyiGeek&scope=repository%3Adevops%2Fbusybox%3A%2A&service=harbor-registry
  # DEBU[0000] GET https://harbor.weiyigeek.top/v2/devops/busybox/manifests/latest
  # DEBU[0000] DELETE https://harbor.weiyigeek.top/v2/devops/busybox/manifests/sha256:62ffc2ed7554e4c6d360bce40bbcf196573dd27c4ce080641a2c59867e732dee
  # DEBU[0000] Deleting /home/weiyigeek/.local/share/containers/sigstore/devops/busybox@sha256=62ffc2ed7554e4c6d360bce40bbcf196573dd27c4ce080641a2c59867e732dee/signature-1

# æ–¹å¼2.åˆ©ç”¨curl å‘½ä»¤è¿›è¡Œregisteryè¿›è¡Œåˆ é™¤Tagã€‚
curl --header "Accept: application/vnd.docker.distribution.manifest.v2+json" -I -X GET http://192.168.12.111:5000/v2/busybox/manifests/latest
  # HTTP/1.1 200 OK
  # Content-Length: 527
  # Content-Type: application/vnd.docker.distribution.manifest.v2+json
  # Docker-Content-Digest: sha256:62ffc2ed7554e4c6d360bce40bbcf196573dd27c4ce080641a2c59867e732dee
  # Docker-Distribution-Api-Version: registry/2.0
  # Etag: "sha256:62ffc2ed7554e4c6d360bce40bbcf196573dd27c4ce080641a2c59867e732dee"
  # X-Content-Type-Options: nosniff
  # Date: Thu, 20 Jan 2022 13:18:28 GMT

# ä¸€æŠŠæ¢­ç»‡æå®š
Docker-Content-Digest=$(curl -s --header "Accept: application/vnd.docker.distribution.manifest.v2+json" -I -X GET http://192.168.12.111:5000/v2/busybox/manifests/latest | grep "Docker-Content-Digest" | cut -d ' ' -f 2)
curl -I -X DELETE http://192.168.12.111:5000/v2/busybox/manifests/${Docker-Content-Digest}
```

æœ¬ç« èŠ‚ï¼Œä¸»è¦å‚è€ƒæˆ‘å‰åŒäº‹æœ¨å­åšå®¢(https://blog.k8s.li/skopeo.html)ã€‚

å‡å¦‚,ç»™ä½ ä¸€ä¸ªé•œåƒåˆ—è¡¨ images-list.txt, å…¶æ ¼å¼å¦‚ä¸‹, æˆ‘ä»¬å¯ä»¥ç›´æ¥é‡‡ç”¨shellè„šæœ¬è°ƒç”¨skopeoè¿›è¡Œæ‰§è¡Œã€‚

```
# images-list.txt
cat <<'EOF' > images-list.txt
kubesphere/kube-apiserver:v1.20.6
kubesphere/kube-scheduler:v1.20.6
kubesphere/kube-proxy:v1.20.6
kubesphere/kube-controller-manager:v1.20.6
kubesphere/kube-apiserver:v1.19.8
EOF
```

**åŒæ­¥çš„shellè„šæœ¬Â skopeo-copy.sh**

```
#!/bin/bash
GREEN_COL="\\033[32;1m"
RED_COL="\\033[1;31m"
NORMAL_COL="\\033[0;39m"

SOURCE_REGISTRY=$1
TARGET_REGISTRY=$2

# shell å˜é‡èµ‹å€¼ï¼Œå½“æ²¡æœ‰ä»å‘½ä»¤è¡Œä¸­ä¼ é€’å€¼ç»™SOURCE_REGISTRYå’ŒTARGET_REGISTRYå˜é‡æ—¶ï¼Œä¾¿é‡‡ç”¨ä¸‹è¿°å€¼è¿›è¡Œè¦†ç›–ã€‚
: ${IMAGES_LIST_FILE:="images-list.txt"}
: ${TARGET_REGISTRY:="hub.k8s.li"}
: ${SOURCE_REGISTRY:="docker.io"}

BLOBS_PATH="docker/registry/v2/blobs/sha256"
REPO_PATH="docker/registry/v2/repositories"

set -eo pipefail

CURRENT_NUM=0
ALL_IMAGES="$(sed -n '/#/d;s/:/:/p' ${IMAGES_LIST_FILE} | sort -u)"
TOTAL_NUMS=$(echo "${ALL_IMAGES}" | wc -l)

# shopeo æ‹·è´å‡½æ•°ï¼Œæ³¨æ„å…¶ä¼ é€’çš„å‚æ•°ï¼Œæ­¤å¤„å€¼å¾—å­¦ä¹ è®°å½•ã€‚
skopeo_copy() {
 if skopeo copy --insecure-policy --src-tls-verify=false --dest-tls-verify=false \
 --override-arch amd64 --override-os linux -q docker://$1 docker://$2; then
  echo -e "$GREEN_COL Progress: ${CURRENT_NUM}/${TOTAL_NUMS} sync $1 to $2 successful $NORMAL_COL"
 else
  echo -e "$RED_COL Progress: ${CURRENT_NUM}/${TOTAL_NUMS} sync $1 to $2 failed $NORMAL_COL"
  exit 2
 fi
}

# è°ƒç”¨æ‹·è´å‡½æ•°å¹¶è®°å½•å½“å‰æ‰§è¡Œåºå·ã€‚
for image in ${ALL_IMAGES}; do
 let CURRENT_NUM=${CURRENT_NUM}+1
 skopeo_copy ${SOURCE_REGISTRY}/${image} ${TARGET_REGISTRY}/${image}
done
```

**æ‰§è¡Œå‘½ä»¤å’Œç»“æœ:**

```
$ bash sync.sh docker.io localhost:5000
Progress: 1/143 sync docker.io/alpine:3.14 to localhost:5000/alpine:3.14 successful
Progress: 2/143 sync docker.io/busybox:1.31.1 to localhost:5000/busybox:1.31.1 successful
....
Progress: 142/143 sync docker.io/weaveworks/scope:1.13.0 to localhost:5000/weaveworks/scope:1.13.0 successful
Progress: 143/143 sync docker.io/wordpress:4.8-apache to localhost:5000/wordpress:4.8-apache successful
```

æè¿°: å°†é•œåƒä» registry ä¸­åŒæ­¥åˆ°æœ¬åœ°ç›®å½•ï¼Œä½¿ç”¨ registry å­˜å‚¨çš„ç‰¹æ€§ï¼Œå°†æœ¬åœ°ç›®å½•ä¸­çš„é•œåƒè½¬æ¢æˆ registry å­˜å‚¨çš„æ ¼å¼, è¿™æ ·çš„å¥½å¤„å°±æ˜¯å¯ä»¥å»é™¤ä¸€äº› skopeo dir ä¸­é‡å¤çš„ layersï¼Œå‡å°‘é•œåƒçš„æ€»å¤§å°ã€‚

convert-images.sh

```
#!/bin/bash
set -eo pipefail

GREEN_COL="\\033[32;1m"
RED_COL="\\033[1;31m"
NORMAL_COL="\\033[0;39m"

# å‘½ä»¤è¡Œå‚æ•°
SOURCE_REGISTRY=$1
TARGET_REGISTRY=$2
IMAGES_DIR=$2

: ${IMAGES_DIR:="images"}
: ${IMAGES_LIST_FILE:="images-list.txt"}
: ${SOURCE_REGISTRY:="docker.io"}
: ${TARGET_REGISTRY:="hub.k8s.li"}

# hub.k8s.li ä»“åº“æœåŠ¡å™¨ä¸­çš„ç›®å½•
BLOBS_PATH="docker/registry/v2/blobs/sha256"
REPO_PATH="docker/registry/v2/repositories"

# è®°å½•å½“å‰æ•°å’Œæ€»é•œåƒæ•°
CURRENT_NUM=0
ALL_IMAGES="$(sed -n '/#/d;s/:/:/p' ${IMAGES_LIST_FILE} | sort -u)"
TOTAL_NUMS=$(echo "${ALL_IMAGES}" | wc -l)

# ä»è¿œç¨‹ä»“åº“åŒæ­¥æŒ‡å®šé•œåƒåˆ°æœ¬åœ°ç›®å½•ä¸­ã€‚
skopeo_sync() {
 if skopeo sync --insecure-policy --src-tls-verify=false --dest-tls-verify=false \
 --override-arch amd64 --override-os linux --src docker --dest dir $1 $2 > /dev/null; then
  echo -e "$GREEN_COL Progress: ${CURRENT_NUM}/${TOTAL_NUMS} sync $1 to $2 successful $NORMAL_COL"
 else
  echo -e "$RED_COL Progress: ${CURRENT_NUM}/${TOTAL_NUMS} sync $1 to $2 failed $NORMAL_COL"
  exit 2
 fi
}

convert_images() {
 rm -rf ${IMAGES_DIR}; mkdir -p ${IMAGES_DIR}
 for image in ${ALL_IMAGES}; do
  let CURRENT_NUM=${CURRENT_NUM}+1
  
  # å– images-list.txt æ–‡æœ¬ä¸­çš„æ¯ä¸€è¡Œï¼Œå¹¶åˆ†éš”å­˜å‚¨ã€‚
  image_name=${image%%:*}
  image_tag=${image##*:}
  image_repo=${image%%/*}

  # å‡½æ•°è°ƒç”¨ ä»ä»“åº“åŒæ­¥é•œåƒåˆ°æœ¬åœ°imagesç›®å½•
  skopeo_sync ${SOURCE_REGISTRY}/${image} ${IMAGES_DIR}/${image_repo}

  # åœ¨æœ¬åœ°imagesç›®å½•ä¸­ï¼Œå–å¾—get image manifest sha256sum ä¿¡æ¯
  manifest="${IMAGES_DIR}/${image}/manifest.json"
  manifest_sha256=$(sha256sum ${manifest} | awk '{print $1}')      # 62ffc2ed7554e4c6d360bce40bbcf196573dd27c4ce080641a2c59867e732dee
  mkdir -p ${BLOBS_PATH}/${manifest_sha256:0:2}/${manifest_sha256} # docker/registry/v2/blobs/sha256/62/62ffc2ed7554e4c6d360bce40bbcf196573dd27c4ce080641a2c59867e732dee
  ln -f ${manifest} ${BLOBS_PATH}/${manifest_sha256:0:2}/${manifest_sha256}/data  #  è¯¥ data æ–‡ä»¶å®é™…ä¸Šæ˜¯é•œåƒçš„ manifest.json æ–‡ä»¶ã€‚

  # make image repositories dir
  mkdir -p ${REPO_PATH}/${image_name}/{_uploads,_layers,_manifests}
  mkdir -p ${REPO_PATH}/${image_name}/_manifests/revisions/sha256/${manifest_sha256}
  mkdir -p ${REPO_PATH}/${image_name}/_manifests/tags/${image_tag}/{current,index/sha256}
  mkdir -p ${REPO_PATH}/${image_name}/_manifests/tags/${image_tag}/index/sha256/${manifest_sha256}

  # create image tag manifest link file
  echo -n "sha256:${manifest_sha256}" > ${REPO_PATH}/${image_name}/_manifests/revisions/sha256/${manifest_sha256}/link  # sha256:62ffc2ed7554e4c6d360bce40bbcf196573dd27c4ce080641a2c59867e732deer
  echo -n "sha256:${manifest_sha256}" > ${REPO_PATH}/${image_name}/_manifests/tags/${image_tag}/current/link
  echo -n "sha256:${manifest_sha256}" > ${REPO_PATH}/${image_name}/_manifests/tags/${image_tag}/index/sha256/${manifest_sha256}/link

  # link image layers file to registry blobs dir
  for layer in $(sed '/v1Compatibility/d' ${manifest} | grep -Eo "\b[a-f0-9]{64}\b"); do  # åŒ¹é… manifest.json ä¸­"digest"ä¸¤ä¸ªä¸å¸¦sha256çš„å€¼
    mkdir -p ${BLOBS_PATH}/${layer:0:2}/${layer}                 # 5cc84ad355aaa64f46ea9c7bbcc319a9d808ab15088a27209c9e70ef86e5a2aa ã€ beae173ccac6ad749f76713cf4440fe3d21d1043fe616dfbe30775815d1d0f6a
    mkdir -p ${REPO_PATH}/${image_name}/_layers/sha256/${layer}  # 5cc84ad355aaa64f46ea9c7bbcc319a9d808ab15088a27209c9e70ef86e5a2aa ã€ beae173ccac6ad749f76713cf4440fe3d21d1043fe616dfbe30775815d1d0f6a
    echo -n "sha256:${layer}" > ${REPO_PATH}/${image_name}/_layers/sha256/${layer}/link  # sha256:5cc84ad355aaa64f46ea9c7bbcc319a9d808ab15088a27209c9e70ef86e5a2aa
    ln -f ${IMAGES_DIR}/${image}/${layer} ${BLOBS_PATH}/${layer:0:2}/${layer}/data     # å¤åˆ¶imagesç›®å½•ä¸­ "application/vnd.docker.container.image.v1+json" å®¹å™¨é…ç½® config ä¸ å¤šä¸ª "application/vnd.docker.image.rootfs.diff.tar.gzip" layer 
  done
 done
}

convert_images
```

-   install.shÂ : ä½¿ç”¨è¿™ä¸ªè„šæœ¬å°† registry å­˜å‚¨ä¸­çš„é•œåƒè½¬æ¢æˆ skopeo dir çš„æ–¹å¼ï¼Œç„¶åå†å°†é•œåƒåŒæ­¥åˆ° registry ä¸­ã€‚
    

```
#!/bin/bash
REGISTRY_DOMAIN="harbor.k8s.li"
REGISTRY_PATH="/var/lib/registry"

# åˆ‡æ¢åˆ° registry å­˜å‚¨ä¸»ç›®å½•ä¸‹
cd ${REGISTRY_PATH}
gen_skopeo_dir() {
   # å®šä¹‰ registry å­˜å‚¨çš„ blob ç›®å½• å’Œ repositories ç›®å½•ï¼Œæ–¹ä¾¿åé¢ä½¿ç”¨
    BLOB_DIR="docker/registry/v2/blobs/sha256"
    REPO_DIR="docker/registry/v2/repositories"
    # å®šä¹‰ç”Ÿæˆ skopeo ç›®å½•
    SKOPEO_DIR="docker/skopeo"
    # é€šè¿‡ find å‡º current æ–‡ä»¶å¤¹å¯ä»¥å¾—åˆ°æ‰€æœ‰å¸¦ tag çš„é•œåƒï¼Œå› ä¸ºä¸€ä¸ª tag å¯¹åº”ä¸€ä¸ª current ç›®å½•
    for image in $(find ${REPO_DIR} -type d -name "current"); do
        # æ ¹æ®é•œåƒçš„ tag æå–é•œåƒçš„åå­—
        name=$(echo ${image} | awk -F '/' '{print $5"/"$6":"$9}')
        link=$(cat ${image}/link | sed 's/sha256://')
        mfs="${BLOB_DIR}/${link:0:2}/${link}/data"
        # åˆ›å»ºé•œåƒçš„ç¡¬é“¾æ¥éœ€è¦çš„ç›®å½•
        mkdir -p "${SKOPEO_DIR}/${name}"
        # ç¡¬é“¾æ¥é•œåƒçš„ manifests æ–‡ä»¶åˆ°ç›®å½•çš„ manifest æ–‡ä»¶
        ln ${mfs} ${SKOPEO_DIR}/${name}/manifest.json
        # ä½¿ç”¨æ­£åˆ™åŒ¹é…å‡ºæ‰€æœ‰çš„ sha256 å€¼ï¼Œç„¶åæ’åºå»é‡
        layers=$(grep -Eo "\b[a-f0-9]{64}\b" ${mfs} | sort -n | uniq)
        for layer in ${layers}; do
          # ç¡¬é“¾æ¥ registry å­˜å‚¨ç›®å½•é‡Œçš„é•œåƒ layer å’Œ images config åˆ°é•œåƒçš„ dir ç›®å½•
            ln ${BLOB_DIR}/${layer:0:2}/${layer}/data ${SKOPEO_DIR}/${name}/${layer}
        done
    done
}
sync_image() {
    # ä½¿ç”¨ skopeo sync å°† dir æ ¼å¼çš„é•œåƒåŒæ­¥åˆ° harbor
    for project in $(ls ${SKOPEO_DIR}); do
        skopeo sync --insecure-policy --src-tls-verify=false --dest-tls-verify=false \
        --src dir --dest docker ${SKOPEO_DIR}/${project} ${REGISTRY_DOMAIN}/${project}
    done
}
gen_skopeo_dir
```

æ¸©é¦¨æç¤º: æ­¤ç§æ–¹å¼æ˜¯æœ‰äº›å¤æ‚å¯¹äºå¤§é•œåƒçš„å¤åˆ¶æ˜¯æ¨èçš„, è€Œå¯¹äºä¸€äº›å°é•œåƒä¸”æ˜¾å¾—å¤šä½™ã€‚

æè¿°: å…ˆå°†é•œåƒåŒæ­¥åˆ°ä¸€ä¸ª registry ä¸­ï¼Œå†å°†é•œåƒä» registry å­˜å‚¨ä¸­æå‡ºæ¥ï¼Œè¯¥ registry å¯ä»¥å½“ä½œä¸€ä¸ªé•œåƒå­˜å‚¨çš„æ± å­ï¼Œæˆ‘ä»¬ä½¿ç”¨ Linux ä¸­ç¡¬é“¾æ¥çš„ç‰¹æ€§å°†é•œåƒ"å¤åˆ¶"ä¸€ä»½å‡ºæ¥ï¼Œç„¶åå†æ‰“ä¸€ä¸ª tar åŒ…, è¿™æ ·åšçš„å¥½å¤„å°±æ˜¯æ¯æ¬¡æ‰“åŒ…é•œåƒçš„æ—¶å€™éƒ½èƒ½å¤ç”¨å†å²çš„é•œåƒæ•°æ®ï¼Œè€Œä¸”æ€§èƒ½æå¿«ã€‚

æ­¥éª¤ 01.å…ˆå°†é•œåƒåŒæ­¥åˆ°ä¸€ä¸ªå›ºå®šçš„ registry ä¸­ã€‚

```
$ bash skopeo-copy.sh docker.io localhost:5000
```

æ­¥éª¤ 02.ä½¿ç”¨è¯¥è„šæœ¬å°†é•œåƒä» registry å­˜å‚¨ä¸­æå‡ºæ¥

```
#!/bin/bash
set -eo pipefail
# å‘½ä»¤è¡Œå˜é‡
IMAGES_LIST="$1"
REGISTRY_PATH="$2"
OUTPUT_DIR="$3"

# Registry ä»“åº“æ•°æ®ç›®å½•
BLOB_DIR="docker/registry/v2/blobs/sha256"
REPO_DIR="docker/registry/v2/repositories"

# åˆ¤æ–­è¾“å‡ºç›®å½•æ˜¯å¦å­˜åœ¨å¦‚ä¸å­˜åœ¨åˆ™ç§»é™¤ã€‚
if [ -d ${OUTPUT_DIR} ];then
  rm -rf ${OUTPUT_DIR};
fi
mkdir -p ${OUTPUT_DIR}

for image in $(find ${IMAGES_LIST} -type f -name "*.list" | xargs grep -Ev '^#|^/' | grep ':'); do
  # é•œåƒåç§°å’ŒTag
  image_name=${image%%:*}
  image_tag=${image##*:}

  # link è·¯å¾„è·å–
  tag_link=${REGISTRY_PATH}/${REPO_DIR}/${image_name}/_manifests/tags/${image_tag}/current/link
  manifest_sha256=$(sed 's/sha256://' ${tag_link})
  manifest=${REGISTRY_PATH}/${BLOB_DIR}/${manifest_sha256:0:2}/${manifest_sha256}/data
  mkdir -p ${OUTPUT_DIR}/${BLOB_DIR}/${manifest_sha256:0:2}/${manifest_sha256}

  # å¼ºåˆ¶ç¡¬é“¾æ¥åˆ°æŒ‡å®šç›®å½•
  ln -f ${manifest} ${OUTPUT_DIR}/${BLOB_DIR}/${manifest_sha256:0:2}/${manifest_sha256}/data

  # make image repositories dir
  mkdir -p ${OUTPUT_DIR}/${REPO_DIR}/${image_name}/{_uploads,_layers,_manifests}
  mkdir -p ${OUTPUT_DIR}/${REPO_DIR}/${image_name}/_manifests/revisions/sha256/${manifest_sha256}
  mkdir -p ${OUTPUT_DIR}/${REPO_DIR}/${image_name}/_manifests/tags/${image_tag}/{current,index/sha256}
  mkdir -p ${OUTPUT_DIR}/${REPO_DIR}/${image_name}/_manifests/tags/${image_tag}/index/sha256/${manifest_sha256}

  # create image tag manifest link file  
  echo -n "sha256:${manifest_sha256}" > ${OUTPUT_DIR}/${REPO_DIR}/${image_name}/_manifests/tags/${image_tag}/current/link
  echo -n "sha256:${manifest_sha256}" > ${OUTPUT_DIR}/${REPO_DIR}/${image_name}/_manifests/revisions/sha256/${manifest_sha256}/link
  echo -n "sha256:${manifest_sha256}" > ${OUTPUT_DIR}/${REPO_DIR}/${image_name}/_manifests/tags/${image_tag}/index/sha256/${manifest_sha256}/link

  # å¼ºåˆ¶åˆ›å»º /docker/registry/v2/blobs/ å„ layer data æ–‡ä»¶åˆ°æŒ‡å®šç›®å½•ä¹‹ä¸­
  for layer in $(sed '/v1Compatibility/d' ${manifest} | grep -Eo '\b[a-f0-9]{64}\b' | sort -u); do
      mkdir -p ${OUTPUT_DIR}/${BLOB_DIR}/${layer:0:2}/${layer}
      mkdir -p ${OUTPUT_DIR}/${REPO_DIR}/${image_name}/_layers/sha256/${layer}
      ln -f ${BLOB_DIR}/${layer:0:2}/${layer}/data ${OUTPUT_DIR}/${BLOB_DIR}/${layer:0:2}/${layer}/data
      echo -n "sha256:${layer}" > ${OUTPUT_DIR}/${REPO_DIR}/${image_name}/_layers/sha256/${layer}/link
  done
done
```

è‡³æ­¤æœ¬èŠ‚å®Œæ¯•ï¼Œæ•¬è¯·æœŸå¾…ä¸‹ä¸€å°èŠ‚å†…å®¹ã€‚

Dockerå®¹å™¨æŠ€æœ¯å…¥é—¨å®è·µç³»åˆ—å†å²å·²å‘å¸ƒæ–‡ç« ï¼ˆç‚¹å‡»å³å¯è¿›å…¥ï¼‰ï¼š

[1.æˆ‘åœ¨Bç«™å­¦äº‘åŸç”Ÿä¹‹Dockerå®¹å™¨æŠ€æœ¯åŸºç¡€çŸ¥è¯†ä»‹ç»](https://www.bilibili.com/read/cv15180540)

[2.æˆ‘åœ¨Bç«™å­¦äº‘åŸç”Ÿä¹‹Dockerå®¹å™¨ç¯å¢ƒå®‰è£…å®è·µ](https://www.bilibili.com/read/cv15181036)

[3.æˆ‘åœ¨Bç«™å­¦äº‘åŸç”Ÿä¹‹Dockerå®¹å™¨ä¸‰å¤§æ ¸å¿ƒæ¦‚å¿µä»‹ç»](https://www.bilibili.com/read/cv15181760)

[4.æˆ‘åœ¨Bç«™å­¦äº‘åŸç”Ÿä¹‹Dockerå®¹å™¨æ•°æ®æŒä¹…åŒ–ä»‹ç»ä¸å®è·µ](https://www.bilibili.com/read/cv15182308)

[5.æˆ‘åœ¨Bç«™å­¦äº‘åŸç”Ÿä¹‹Dockerå®¹å™¨ç½‘ç»œä»‹ç»ä¸å®è·µ](https://www.bilibili.com/read/cv15185166)

[6.æˆ‘åœ¨Bç«™å­¦äº‘åŸç”Ÿä¹‹Dockerå®¹å™¨Registryç§æœ‰é•œåƒä»“åº“æ­å»ºå®è·µ](https://www.bilibili.com/read/cv15219863)

[7.æˆ‘åœ¨Bç«™å­¦äº‘åŸç”Ÿä¹‹Dockerå®¹å™¨Dockerfileé•œåƒæ„å»ºæµ…æä¸å®è·µ](https://www.bilibili.com/read/cv15220707)

[8.æˆ‘åœ¨Bç«™å­¦äº‘åŸç”Ÿä¹‹Dockerå®¹å™¨é•œåƒæ„å»ºæœ€ä½³å®è·µæµ…æ](https://www.bilibili.com/read/cv15220861)

[9.æˆ‘åœ¨Bç«™å­¦äº‘åŸç”Ÿä¹‹Dockerå®¹å™¨ä¼˜åŒ–é•œåƒä½“ç§¯ç¼©å°æŠ€å·§å®è·µ](https://www.bilibili.com/read/cv15226873)

[10.æˆ‘åœ¨Bç«™å­¦äº‘åŸç”Ÿä¹‹Dockerå®¹å™¨æŠ€æœ¯è¿›é˜¶çŸ¥è¯†ä»‹ç»](https://www.bilibili.com/read/cv15227279)

[11.æˆ‘åœ¨Bç«™å­¦äº‘åŸç”Ÿä¹‹Dockerå®¹å™¨ç¼–æ’å·¥å…·docker-composeå®‰è£…ä½¿ç”¨å®è·µ](https://www.bilibili.com/read/cv15227639)

[12.æˆ‘åœ¨Bç«™å­¦äº‘åŸç”Ÿä¹‹Dockerå®¹å™¨åº•å±‚åŸç†æµ…æ](https://www.bilibili.com/read/cv15228563)

[13.æˆ‘åœ¨Bç«™å­¦äº‘åŸç”Ÿä¹‹Dockerå®¹å™¨é•œåƒæ„å»ºå­˜å‚¨åŸç†æµ…æä¸å®è·µ](https://www.bilibili.com/read/cv15229214)

[14.æˆ‘åœ¨Bç«™å­¦äº‘åŸç”Ÿä¹‹Dockerå®¹å™¨Registryç§æœ‰é•œåƒä»“åº“å®‰å…¨é…ç½®ä¸GCå›æ”¶å®è·µ](https://www.bilibili.com/read/cv15237911)Â 

[15.æˆ‘åœ¨Bç«™å­¦äº‘åŸç”Ÿä¹‹Dockeré•œåƒå®‰å…¨æœ€ä½³å®è·µ](https://www.bilibili.com/read/cv15553799)

[16.æˆ‘åœ¨Bç«™å­¦äº‘åŸç”Ÿä¹‹Dockerå®¹å™¨å®‰å…¨æœ€ä½³å®è·µ](https://www.bilibili.com/read/cv15554240)

[17.æˆ‘åœ¨Bç«™å­¦äº‘åŸç”Ÿä¹‹Dockerå®¹å™¨ç›¸å…³è¾…åŠ©å·¥å…·ä½¿ç”¨ä»‹ç»](https://www.bilibili.com/read/cv15669979)

[18.æˆ‘åœ¨Bç«™å­¦äº‘åŸç”Ÿä¹‹Dockerå®¹å™¨å®‰è£…è¿è¡Œæ‰€é‡å¼‚å¸¸é—®é¢˜è§£å†³é›†åˆ](https://www.bilibili.com/read/cv15670482)

[19.æˆ‘åœ¨Bç«™å­¦äº‘åŸç”Ÿä¹‹Harborä¼ä¸šçº§ç§æœ‰é•œåƒå­˜å‚¨ä»“åº“å…¥é—¨å®è·µ](https://www.bilibili.com/read/cv15720450)

![](https://i0.hdslb.com/bfs/article/4adb9255ada5b97061e610b682b8636764fe50ed.png@progressive.webp)

> æ¬¢è¿å„ä½å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œå¦‚æ–‡ç« æœ‰è¯¯è¯·åœ¨ä¸‹æ–¹ç•™ä¸‹æ‚¨å®è´µçš„ç»éªŒçŸ¥è¯†ï¼Œä¸ªäººé‚®ç®±åœ°å€ã€master#weiyigeek.topã€‘æˆ–è€…Â ä¸ªäººå…¬ä¼—å·ã€WeiyiGeekã€‘è”ç³»æˆ‘ã€‚

![](https://i0.hdslb.com/bfs/article/02db465212d3c374a43c60fa2625cc1caeaab796.png@progressive.webp)

æ›´å¤šæ–‡ç« æ¥æºäºã€WeiyiGeek Blog - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘ã€‘ ä¸ªäººåšå®¢ã€‚

ä¸ªäººä¸»é¡µ: https://weiyigeek.top  

åšå®¢åœ°å€: https://blog.weiyigeek.top

![](https://i0.hdslb.com/bfs/article/9a9cef9d789c08c7d7cb209475b46586777c9d26.png@942w_579h_progressive.webp)

å¿ƒæœ‰å±±æµ·,çŸœè€Œä¸äº‰ï¼

ä¸“æ ä¹¦å†™ä¸æ˜“ï¼Œå¦‚æœæ‚¨è§‰å¾—è¿™ä¸ªä¸“æ è¿˜ä¸é”™çš„ï¼Œè¯·ç»™è¿™ç¯‡ä¸“æ ã€ç‚¹ä¸ªèµã€æŠ•ä¸ªå¸ã€æ”¶ä¸ªè—ã€å…³ä¸ªæ³¨ï¼Œè½¬ä¸ªå‘ã€‘ï¼Œè¿™å°†å¯¹æˆ‘çš„è‚¯å®šï¼Œè°¢è°¢ï¼ã€‚

-   echoÂ Â "ã€ç‚¹ä¸ªèµã€‘ï¼ŒåŠ¨åŠ¨ä½ é‚£ç²—å£®çš„æ‹‡æŒ‡æˆ–è€…èŠŠèŠŠç‰æ‰‹ï¼Œäº²ï¼"
    
-   printf("%s",Â "ã€æŠ•ä¸ªå¸ã€‘ï¼Œä¸‡æ°´åƒå±±æ€»æ˜¯æƒ…ï¼ŒæŠ•ä¸ªç¡¬å¸è¡Œä¸è¡Œï¼Œäº²ï¼")
    
-   fmt.Printf("ã€æ”¶ä¸ªè—ã€‘ï¼Œé˜…åå³ç„šä¸åƒç°ï¼Œäº²ï¼")Â Â 
    
-   System.out.println("ã€å…³ä¸ªæ³¨ã€‘ï¼Œåç»­æµè§ˆæŸ¥çœ‹ä¸è¿·è·¯å“Ÿï¼Œäº²ï¼")
    
-   console.info("ã€è½¬ä¸ªå‘ã€‘ï¼Œè®©æ›´å¤šçš„å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œäº²ï¼")