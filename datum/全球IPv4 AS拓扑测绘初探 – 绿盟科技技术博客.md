阅读： 29

## ****一、前言****

网络拓扑测绘是网络空间测绘中的关键一环，主要体现了网络空间中资源之间的物理和逻辑通联关系。根据OSI七层网络体系结构分，有物理层的光纤、电缆拓扑，数据链路层的二层交换机拓扑，网络层的路由器拓扑，应用层的服务拓扑等等。本文主要考虑****网络层的A********S********（********Autonomous System********，自治域）级拓扑****，面向全球IPv4地址空间自治域编号，研究其注册、分配、使用现状，为后续重点关注地区网络拓扑测绘提供数据和技术支撑。

## ****二、基本概念****

下面介绍AS级网络拓扑相关的基本概念。

-   ****网络拓扑****

本文定义的****网络拓扑****，是面向某种计算机网络环境，对搭建网络、承担信息通信功能的物理或逻辑节点，及其之间物理或逻辑上的通联关系和通信路径，进行探测和分析，得到的****物理********或********逻辑上****的网络拓扑图\[1\]，如图 2.1 所示。

![](http://blog.nsfocus.net/wp-content/uploads/2022/09/1-300x199.png)

网络拓扑示例\[2\]

随着网络规模的日益复杂，网络多样化、异构化的逐渐凸显，网络正常、安全的运行，成为人们关注的热点。****对网络拓扑进行测绘，有助于网络瓶颈的发现、网络故障的定位、网络配置的优化、以及网络潜在危险的发现****：比如可以用于网络仿真实验，构建网络拓扑图来模拟真实的网络，分析网络攻击、进行防范；帮助网络管理者发现网络瓶颈、查看网络配置是否正确、以及是否在特定位置增加路由器等等。

****网络拓扑测绘的主要区别在于网络环境、拓扑节点（网络设备类型）、拓扑连接（通信方式********/协议********）、拓扑结构等****：不同的网络环境，拓扑测绘的侧重点、使用技术会有所不同；****拓扑节点****作为构成拓扑图的基本点元素，其中物理拓扑偏向实体设备识别、定位，逻辑拓扑偏向数据汇聚的业务处理点；****拓扑连接****表示节点之间的关系，其中物理拓扑代表通过电缆等通信介质直接相连得到的点之间连接关系，逻辑拓扑则代表数据通信的抽象通联关系和路径；****拓扑结构****由拓扑节点和拓扑连接共同组成，存在一些特定场景适用的通用拓扑结构形式，从整个大网来看，拓扑结构十分复杂，但可以拆分成特定形式单元。

-   ****拓扑分类****

****根据拓扑结构分****，如图 2.2 所示，主要有点对点（Point-to-point）、总线拓朴（Bus）、环状拓朴（Ring）、星状拓朴（Star）、树状拓朴（Tree）、网状拓朴（Mesh）、混合式拓朴（Hybrid）等等\[3\]。

![](http://blog.nsfocus.net/wp-content/uploads/2022/09/2-300x157.png)

网络拓扑结构类型\[3\]

****根据O********SI********七层网络体系结构分，有物理层、数据链路层、网络层、应用层拓扑等****：物理层拓扑主要指光纤、电缆等实际部署的物理拓扑；数据链路层拓扑主要指子网，二层交换机的拓扑；网络层拓扑主要指从IP开始不断往路由器、PoP、AS汇聚的逻辑拓扑；应用层拓扑主要指基于协议识别与解析，通过识别设备提供的服务与连接协议，得到组件、服务之间的拓扑。

如图 2.3 所示，进一步****在网络层拓扑中****，从终端IP开始不断往路由器、PoP、AS层级进行汇聚，****可以分成********IP接口级********、路由器级、********PoP****（Point of Presence，接入点）****级********、********AS****（Autonomous System，自治域）****级********拓扑****。

![](http://blog.nsfocus.net/wp-content/uploads/2022/09/3-300x200.png)

网络层拓扑分级\[4\]

****IP接口级********拓扑****是指最基础的IP地址之间的连接关系，一般采用基于SNMP协议、ICMP协议、Traceroute等主动探测方式发送请求包，根据返回的相关字段信息发现IP地址间的通联关系；拓扑图中的每一个节点表示一个IP地址。

****路由器级拓扑****是指在IP接口级拓扑上，基于别名解析等相关技术，识别出属于同一网络设备的多个IP地址，同时需要解决匿名路由和路由欺骗的问题，正确的识别并删除拓扑识别中出现的未知节点，把同一路由器的多个IP进行归一，以提升拓扑的准确性；拓扑图中的每一个节点表示一个路由器。

****PoP级********拓扑****是指在路由器级拓扑上，基于路由聚簇、路由定位等技术，通过把地理位置相同的路由器进行归一，表示PoP之间的连接关系；拓扑图中的每一个节点表示同一个AS中位于相同位置的路由器集合PoP，也称作AS域内拓扑。

****AS级********拓扑****是指在PoP级拓扑上，基于BGP路由协议、Traceroute、IRR（Internet Routing Registry，互联网路由注册局）数据推断等方法，把属于同一个AS的PoP节点进行归一，发现各个自治系统AS间的连接关系，也称作AS域间拓扑。

****本文主要考虑A********S********级拓扑****，面向全球IPv4地址空间自治域编号，研究其注册、分配、使用现状，为后续重点关注地区网络拓扑测绘提供数据和技术支撑。

-   ****A********S********级拓扑****

在全网IPv4地址空间中，****共计包含6********5536********个A********S****，每个AS都有一个自治域编号（Autonomous System Number, ASN），****其取值范围在0到6********5535********之间****。除了1043个（约1.6%）规定特殊用处的AS外\[5\]，其余AS均被一些组织机构申请注册管理运营。AS通过宣告IP地址前缀，指引网络流量根据目的IP地址路由到准确的AS中。

同时，****A********S********之间的通联关系，可以根据网络接入服务是否付费，主要划分为********2********种情况****（还有1种是连接两个具有共同管理边界的AS，这里暂不考虑）\[6\]。一种是AS双方分别作为****提供商Provider和客户Customer****，表示作为Provider的AS为作为Customer的AS提供接入互联网的服务，客户需要向提供商付费。另一种是AS双方作为****对等体Peer****，它们之间传递网络流量，互不付费。不同的AS角色，会影响AS之间路径推断。

![](http://blog.nsfocus.net/wp-content/uploads/2022/09/4-300x149.png)

AS角色类型\[6\]

## ****三、统计结果****

本文通过****每日定期从多个不同更新频率的数据集中获取****ASN注册、分配与使用的相关字段数据，包括但不限于****A********SN********、注册局、注册机构、国家地区代码、宣告I********P********段、邻居A********S********等****，对原始数据进行解析、融合、规范化后，统一入库存储；然后对其进行统计分析，了解全球IPv4地址空间AS级拓扑现状，持续跟踪其变化情况。

-   ****全球I********P********v********4********地址空间A********S********注册局分布****

如图 3.1 所示，全球AS注册局共计5个，分别是管理非洲地区27357个ASN的****AFRINIC****、亚太地区25062个ASN的****APNIC****、加拿大美国等地区8392个ASN的****ARIN****、拉丁美洲等地区2659个ASN的****LACNIC****、以及欧洲等地区1024个ASN的****RIPE NCC****\[7\]。结合后续对不同国家地区注册机构包含ASN个数的分析，推测****实际申请********ASN********的注册机构不受其所属国家地区地理位置的限制****。

![](http://blog.nsfocus.net/wp-content/uploads/2022/09/5-300x111.png)

AS个数的注册局分布情况

-   ****多个A********SN********共享同一个A********S********名称****

如图 3.2 所示，存在大量ASN共享同一个AS名称，而非一一对应。同时，AS名称的字符串构成方式，往往****结合其注册局、注册机构、包含ASN范围等相关数据进行********拼接****，可通过这种特征识别不同来源的AS。

![](http://blog.nsfocus.net/wp-content/uploads/2022/09/6-300x162.png)

包含ASN个数Top100的AS名称

-   ****2********013********年前A********S********按2的倍数批量注册****

如图 3.3 所示，2013年及以前，注册机构申请AS往往按2的倍数批量注册，如一次性注册16、512、1024、2048、3072个ASN。最近注册时间为2016年，应该是****除保留********AS********以外，其他********AS********已分配殆尽****。

![](http://blog.nsfocus.net/wp-content/uploads/2022/09/7-300x162.png)

AS个数的注册日期倒序（7.29-2002.3.1）

-   ****A********S********修改日期存在峰值关联安全事件****

如图 3.4 所示，AS信息修改日期存在峰值。最近1次峰值日期为****图中红框所示位置——2********022********年********2********月********24********日****，有119个AS的所属组织信息在该日发生变化。从时间推测，****大概率********与2.24俄乌战争爆发有关****。同时，进一步分析发现，发生变化的AS所属组织的国家代码除3个AS分别是巴西、喀麦隆、柬埔寨以外，其余116个均为美国。

![](http://blog.nsfocus.net/wp-content/uploads/2022/09/8-300x161.png)

AS个数的信息修改日期倒序

-   ****不同********注册********机构包含A********SN********个数情况****

如图 3.5 所示，选取包含ASN个数Top100的****全球注册机构****，统计Top100内的占比。DoD Network Information Center（美国国防部网络信息中心）包揽973个ASN位列第一，Renater（法国国家教育与研究网络）包含307个AS位列第二，Headquarters, USAISC（美国国际安全委员会总部）包含290个AS位列第三；中国电信包含108个AS位列第六。

![](http://blog.nsfocus.net/wp-content/uploads/2022/09/9-300x128.png)

AS个数Top100的全球注册机构排序

如图 3.6 所示，选取包含ASN个数Top100的****中国注册机构****，China Telecom（中国电信）包揽108个ASN位列第一，Beijing CNISP Technology（中联网盟）包含35个AS位列第二，China Mobile（中国移动）包含20个AS位列第三。

![](http://blog.nsfocus.net/wp-content/uploads/2022/09/10-300x110.png)

AS个数Top100的中国注册机构排序

-   ****不同国家地区拓扑资源分配情况****

如图 3.7 所示，****根据包含的A********SN********个数、I********P********段个数、I********P********地址个数，对所有国家地区进行排序，获取Top********10********的国家地区****。结果发现****美国****在ASN包含个数、IP段个数、IP地址个数上均为****第********1****；****俄罗斯****虽然在ASN个数上占比****第2****，但IP段个数第3，IP个数第12——说明虽然它包含的ASN个数多，但管理的IP地址很少，切分了很多小块的IP段；****中国****虽然ASN个数排****第1********1****，但IP段个数和IP个数第2——说明虽然ASN少，但可使用的IP地址多，同时也精打细算地切分了很多IP段，以满足大量各种用户的上网需要。

![](http://blog.nsfocus.net/wp-content/uploads/2022/09/11.png)

AS级拓扑的国家地区势力排序

进一步对美国、俄国、中国的****A********S********作为不同角色时的A********S********邻居个数排序，分析其对全球网络拓扑的影响程度，****如图 3.8 所示。****美国****作为Provider的邻居AS个数最多，说明它在ASN层面，其服务提供商****提供的服务范围最广****；同样美国作为Customer的邻居AS个数也最多，说明其网络连接的上层****服务商多样性高，用户体验更佳****，同时推测可能****存在大量AS********作为********中间Provider********和Customer****需要网络服务。****俄罗斯****的AS作为对等体Peer的邻居个数最多，猜测其作为网络拓扑的连通节点，****主要提供连接对等服务，对全球网络连通性影响较大****。****中国****的排名相对靠后，说明中国对全球网络拓扑的****影响力********较为********有限********，****结合前述ASN/IP地址排序，推测****在全球拓扑中鲁棒性较低****。

![](http://blog.nsfocus.net/wp-content/uploads/2022/09/12.png)

国家地区的邻居AS总个数排序

## ****四、总结****

****本文通过对********全球IPv4地址空间********的********AS级拓扑********进行测绘，初探********其注册、分配、使用现状********。****通过上述统计分析发现，受限于部分数据源的月度/季度更新频率，ASN相关注册管理字段变化不大，****统计分析最近********1天即可基本了解********全球I********P********v********4********地址空间********AS********级********拓扑总体********注册、分配********概况****。而持续关注****跟踪********AS********相关信息********修改********日期****，基于历史记录检测峰值，****可********从********侧面反映突发********安全********事件****，有助于同其他领域测绘进行****协同验证****。同时，对比不同国家在AS级拓扑中的影响力发现，****美国****对全网AS级拓扑****影响巨大****；****俄罗斯****虽然IP个数少，但其对全球AS级拓扑连通性****影响很大****；而****中国****虽然IP个数多，但其对全球AS级拓扑连通性****影响有限****。下一步会从AS级拓扑路径推断入手，进行深入分析，验证相关推测，为后续重点关注地区网络拓扑测绘提供数据和技术支撑。

### 参考文献

-   [https://en.wikipedia.org/wiki/Network\_topology](https://en.wikipedia.org/wiki/Network_topology)
-   Meador, Brett. “A survey of computer network topology and analysis examples.” Washington University (2008): 2-3.
-   [https://www.dnsstuff.com/what-is-network-topology](https://www.dnsstuff.com/what-is-network-topology)
-   李雄略.互联网AS级路径推测技术研究.2019.国防科技大学,MA thesis.
-   [https://www.iana.org/assignments/iana-as-numbers-special-registry/iana-as-numbers-special-registry.xhtml](https://www.iana.org/assignments/iana-as-numbers-special-registry/iana-as-numbers-special-registry.xhtml)
-   [https://www.caida.org/catalog/datasets/as-relationships/](https://www.caida.org/catalog/datasets/as-relationships/)
-   [https://www.iana.org/numbers](https://www.iana.org/numbers)

**版权声明**

本站“技术博客”所有内容的版权持有者为绿盟科技集团股份有限公司（“绿盟科技”）。作为分享技术资讯的平台，绿盟科技期待与广大用户互动交流，并欢迎在标明出处（绿盟科技-技术博客）及网址的情形下，全文转发。  
上述情形之外的任何使用形式，均需提前向绿盟科技（010-68438880-5462）申请版权授权。如擅自使用，绿盟科技保留追责权利。同时，如因擅自使用博客内容引发法律纠纷，由使用者自行承担全部法律责任，与绿盟科技无关。