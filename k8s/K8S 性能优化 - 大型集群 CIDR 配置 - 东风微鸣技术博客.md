## 前言[](https://ewhisper.cn/posts/21327/#%E5%89%8D%E8%A8%80%20-4)

K8S 性能优化系列文章，本文为第三篇：Kubernetes 大型集群 CIDR 配置最佳实践。

系列文章：

1.  [《K8S 性能优化 - OS sysctl 调优》](https://ewhisper.cn/posts/5019/)
2.  [《K8S 性能优化 - K8S APIServer 调优》](https://ewhisper.cn/posts/51187/)

在安装大型集群或将现有的集群扩展到较大规模时，在安装集群设置集群网络 cidr 时，如果集群的节点数超过 500 个，则可能无法使用常用的集群网络 cidr `/14`（这里假设的是一个 Node 的 hostPrefix 是 `/23`，那么理论上机器超过 512 台，集群网络 IP 就不够用了）。在这种情况下，必须将其设置为 `/12` 或 `/10`，以支持超过 500 个节点的环境。

## 详细说明[](https://ewhisper.cn/posts/21327/#%E8%AF%A6%E7%BB%86%E8%AF%B4%E6%98%8E)

前提：Overlay 网络

1.  假定 1 个 Node 上 hostPrefix 是 `/24`，那么这台机器理论上有 254 个 pod IP。
    1.  集群网络 cidr 是 `/21`, 理论上集群最多 8 台机器；
    2.  集群网络 cidr 是 `/20`, 16 台；
    3.  …
    4.  `/18`, 64 台；
    5.  `/17`, 128 台；
    6.  `/16`, 256 台；
    7.  `/15`, 512 台；
2.  假定 1 个 Node 上 hostPrefix 是 `/23`，那么这台机器理论上有 510 个 pod IP。
    1.  集群网络 cidr 是 `/20`, 理论上集群最多 8 台机器；
    2.  集群网络 cidr 是 `/19`, 16 台；
    3.  …
    4.  `/17`, 64 台；
    5.  `/16`, 128 台；
    6.  `/15`, 256 台；
    7.  `/14`, 512 台；（出于谨慎，如果集群规模超过 500 台，建议将其设置为 `/12` 或 `/10`）。

EOF