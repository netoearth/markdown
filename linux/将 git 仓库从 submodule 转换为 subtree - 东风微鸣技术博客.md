## ä¸‰ä¸ªè„šæœ¬[](https://ewhisper.cn/posts/58551/#%E4%B8%89%E4%B8%AA%E8%84%9A%E6%9C%AC)

### Alexander Mikhailian[](https://ewhisper.cn/posts/58551/#Alexander-Mikhailian)

<table><tbody><tr><td><pre><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br></pre></td><td><pre><code>cat .gitmodules |<span>while</span> <span>read</span> i<br><span>do</span><br>  <span>if</span> [[<span>$i</span> == \[submodule*]]; <span>then</span><br>    mpath=$(<span>echo</span> <span>$i</span> | cut -d\" -f2)<br>    <span>read</span> i; <span>read</span> i;<br>    murl=$(<span>echo</span> <span>$i</span>|cut -d\  -f3)<br>    mcommit=`<span>eval</span> <span>"git submodule status <span>${mpath}</span> |cut -d\  -f2"</span>`<br>    mname=$(basename <span>$mpath</span>)<br>    <span>echo</span> -e <span>"<span>$name</span>\t<span>$mpath</span>\t<span>$murl</span>\t<span>$mcommit</span>"</span><br>    git submodule deinit <span>$mpath</span><br>    git rm -r --cached <span>$mpath</span><br>    rm -rf <span>$mpath</span><br>    git remote add <span>$mname</span> <span>$murl</span><br>    git fetch <span>$mname</span><br>    git branch _<span>$mname</span> <span>$mcommit</span><br>    git read-tree --prefix=<span>$mpath</span>/ -u _<span>$mname</span><br><span>fi</span><br><span>done</span><br>git rm .gitmodules<br></code><p><i></i>BASH</p></pre></td></tr></tbody></table>

> ğŸ¾**Warning**:
> 
> ä¸‹æ–‡çš„ä¸¤ä¸ªè„šæœ¬, å†™æ­»äº† branch æ˜¯ master, å¦‚æœä¸»åˆ†æ”¯ä¸æ˜¯ master, éœ€è¦åšç›¸åº”ä¿®æ”¹.

### Nikita240 - Stack Overflow[](https://ewhisper.cn/posts/58551/#Nikita240-Stack-Overflow)

> ğŸ“šï¸**Reference**:  
> æˆ‘å¯¹å®ƒè¿›è¡Œäº†ä¿®æ”¹å’Œæ”¹è¿›ã€‚ç°åœ¨ï¼Œæ–°çš„ subtree å°†æŒ‡å‘ä¸æ—§ submodule ç›¸åŒçš„æäº¤ã€‚ä»¥å‰ï¼Œè„šæœ¬åªæ˜¯ä»ç›®æ ‡å­˜å‚¨åº“ä¸‹è½½æœ€æ–°çš„æäº¤ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´å…¼å®¹æ€§é—®é¢˜ã€‚

<table><tbody><tr><td><pre><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br><span>35</span><br><span>36</span><br><span>37</span><br><span>38</span><br><span>39</span><br><span>40</span><br><span>41</span><br><span>42</span><br><span>43</span><br><span>44</span><br><span>45</span><br><span>46</span><br><span>47</span><br><span>48</span><br><span>49</span><br><span>50</span><br><span>51</span><br></pre></td><td><pre><code><span>#!/bin/bash -x</span><br><span># This script will convert all your git submodules into git subtrees.</span><br><span># This script ensures that your new subtrees point to the same commits as the</span><br><span># old submodules did, unlike most other scripts that do this.</span><br><span># THIS SCRIPT MUST BE PLACED OUTSIDE OF YOUR REPOSITORY!!!!!!!!!!</span><br><span># Otherwise, the script will interfere with the git commits.</span><br><span># Save the script in your home directory as `~/subtrees.sh`</span><br><span># `cd` into your repository</span><br><span># Run `~/subtrees.sh`</span><br><span># Enjoy!</span><p><span># extract the list of submodules from .gitmodule</span><br>cat .gitmodules |<span>while</span> <span>read</span> i<br><span>do</span><br><span>if</span> [[<span>$i</span> == \[submodule*]]; <span>then</span><br>    <span>echo</span> converting <span>$i</span><br>    <span>read</span> i<br>    <span># extract the module's prefix</span><br>    mpath=$(<span>echo</span> <span>$i</span> | grep -E <span>"(\S+)$"</span> -o)<br>    <span>echo</span> path: <span>$mpath</span><br>    <span>read</span> i<br>    <span># extract the url of the submodule</span><br>    murl=$(<span>echo</span> <span>$i</span>|cut -d\= -f2|xargs)<br>    <span>echo</span> url: <span>$murl</span><br>    <span># extract the module name</span><br>    mname=$(basename <span>$mpath</span>)<br>    <span>echo</span> name: <span>$mname</span><br>    <span># extract the referenced commit</span><br>    mcommit=$(git submodule status <span>$mpath</span> | grep -E <span>"\S+"</span> -o | head -1)<br>    <span>echo</span> commit: <span>$mcommit</span><br>    <span># deinit the module</span><br>    git submodule deinit <span>$mpath</span><br>    <span># remove the module from git</span><br>    git rm -r --cached <span>$mpath</span><br>    <span># remove the module from the filesystem</span><br>    rm -rf <span>$mpath</span><br>    <span># commit the change</span><br>    git commit -m <span>"Removed <span>$mpath</span> submodule at commit <span>$mcommit</span>"</span><br>    <span># add the remote</span><br>    git remote add -f <span>$mname</span> <span>$murl</span><br>    <span># add the subtree</span><br>    git subtree add --prefix <span>$mpath</span> <span>$mcommit</span> --squash<br>    <span># commit any left over uncommited changes</span><br>    git commit -a -m <span>"<span>$mname</span> cleaned up"</span><br>    <span># fetch the files</span><br>    git fetch <span>$murl</span> master<br>    <span>echo</span><br><span>fi</span><br><span>done</span><br>git rm .gitmodules<br>git commit -a -m <span>"Removed .gitmodules"</span></p></code><p><i></i>BASH</p></pre></td></tr></tbody></table>

### GaspardP - Stack Overflow[](https://ewhisper.cn/posts/58551/#GaspardP-Stack-Overflow)

> ğŸ“šï¸**Reference**:
> 
> æˆ‘ç¨å¾®ä¿®æ”¹äº†ä¸€ä¸‹ï¼Œè°ƒç”¨ `subtree add` è€Œä¸æ˜¯ `read-tree`ã€‚å®ƒå°†ä»`.gitmodule` ä¸­è·å– submodule çš„åˆ—è¡¨ï¼Œå¹¶æå–æ¨¡å—çš„å‰ç¼€ã€åç§°å’Œç½‘å€ã€‚ç„¶åå®ƒåˆ é™¤æ¯ä¸ª submoduleï¼Œå¹¶åœ¨åŒä¸€ä½ç½®æ·»åŠ å®ƒä»¬ä½œä¸º subtreeã€‚å®ƒè¿˜å°†æ¯ä¸ª submodule çš„ remote æ·»åŠ ä¸º remoteï¼Œè¿™æ ·ä½ å°±å¯ä»¥é€šè¿‡æä¾›å®ƒçš„åå­—è€Œä¸æ˜¯å®ƒçš„ç½‘å€æ¥æ›´æ–° subtree äº†ï¼ˆå³ `git subtree pull -P Foo Foo master --squash` è€Œä¸æ˜¯`git subtree pull -P Foo https://example.com/foo.git master --squash`ï¼‰ã€‚
> 
> å¦‚æœä½ æƒ³æŠŠ subtree çš„å…¨éƒ¨å†å²å¯¼å…¥ä½ çš„ç‰ˆæœ¬åº“ï¼Œä½ å¯ä»¥å»æ‰ `--squash` å‚æ•°ã€‚ä½¿ç”¨ `--squash`ï¼Œå°†åªå¯¼å…¥ subtree çš„ HEAD åˆ°ä½ çš„ç‰ˆæœ¬åº“ã€‚è¿™å¯èƒ½æ˜¯å¤§å¤šæ•°äººæƒ³è¦çš„ã€‚

<table><tbody><tr><td><pre><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br><span>35</span><br><span>36</span><br><span>37</span><br><span>38</span><br><span>39</span><br><span>40</span><br><span>41</span><br><span>42</span><br></pre></td><td><pre><code><span>#!/bin/bash -x</span><br><span># extract the list of submodules from .gitmodule</span><br>cat .gitmodules |<span>while</span> <span>read</span> i<br><span>do</span><br><span>if</span> [[<span>$i</span> == \[submodule*]]; <span>then</span><br>    <span>echo</span> converting <span>$i</span><p>    <span># extract the module's prefix</span><br>    mpath=$(<span>echo</span> <span>$i</span> | cut -d\" -f2)</p><p>    <span># skip two lines</span><br>    <span>read</span> i; <span>read</span> i;</p><p>    <span># extract the url of the submodule</span><br>    murl=$(<span>echo</span> <span>$i</span>|cut -d\= -f2|xargs)</p><p>    <span># extract the module name</span><br>    mname=$(basename <span>$mpath</span>)</p><p>    <span># deinit the module</span><br>    git submodule deinit <span>$mpath</span></p><p>    <span># remove the module from git</span><br>    git rm -r --cached <span>$mpath</span></p><p>    <span># remove the module from the filesystem</span><br>    rm -rf <span>$mpath</span></p><p>    <span># commit the change</span><br>    git commit -m <span>"Removed <span>$mpath</span> submodule"</span></p><p>    <span># add the remote</span><br>    git remote add -f <span>$mname</span> <span>$murl</span></p><p>    <span># add the subtree</span><br>    git subtree add --prefix <span>$mpath</span> <span>$mname</span> master --squash</p><p>    <span># fetch the files</span><br>    git fetch <span>$murl</span> master<br><span>fi</span><br><span>done</span><br>git rm .gitmodules</p></code><p><i></i>BASH</p></pre></td></tr></tbody></table>

## ğŸ“šï¸å‚è€ƒæ–‡æ¡£[](https://ewhisper.cn/posts/58551/#%F0%9F%93%9A%EF%B8%8F%E5%8F%82%E8%80%83%E6%96%87%E6%A1%A3%20-15)

-   [Convert a git repository from submodules to subtrees | Alexander Mikhailian (mova.org)](http://mikhailian.mova.org/node/233)
-   [Convert Git submodule to subtree - Stack Overflow](https://stackoverflow.com/questions/28215244/convert-git-submodule-to-subtree)